<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>หน้าหลักผู้ขาย - WebYAI</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            font-family: 'Kanit', sans-serif;
        }
        
        body {
            background-color: #f8f9fa;
        }
        
        .sidebar {
            height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            position: fixed;
            left: 0;
            top: 0;
            width: 250px;
            overflow-y: auto;
            z-index: 1000;
        }
        
        .main-content {
            margin-left: 250px;
            padding: 20px;
        }
        
        .sidebar .nav-link {
            color: rgba(255, 255, 255, 0.8);
            padding: 12px 20px;
            border-radius: 8px;
            margin: 5px 15px;
            transition: all 0.3s ease;
        }
        
        .sidebar .nav-link:hover,
        .sidebar .nav-link.active {
            background-color: rgba(255, 255, 255, 0.2);
            color: white;
            transform: translateX(5px);
        }
        
        .sidebar .nav-link i {
            width: 20px;
            margin-right: 10px;
        }
        
        .store-logo {
            text-align: center;
            padding: 30px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .store-logo h4 {
            color: white;
            margin: 10px 0 5px 0;
        }
        
        .store-logo small {
            color: rgba(255, 255, 255, 0.7);
        }
        
        .dashboard-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            transition: transform 0.3s ease;
            border: none;
            margin-bottom: 30px;
        }
        
        .dashboard-card:hover {
            transform: translateY(-5px);
        }
        
        .stat-card {
            text-align: center;
            padding: 25px 20px;
            border-radius: 15px;
            color: white;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-3px);
        }
        
        .stat-card.sales {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        }
        
        .stat-card.orders {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .stat-card.shipping {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }
        
        .stat-card.stock {
            background: linear-gradient(135deg, #fce38a 0%, #f38181 100%);
        }
        
        .stat-card h3 {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 5px;
        }
        
        .stat-card p {
            margin: 0;
            opacity: 0.9;
        }
        
        .table th {
            background-color: #f8f9fa;
            border: none;
            font-weight: 600;
            color: #495057;
        }
        
        .badge-status {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
        }
        
        .badge-new {
            background-color: #28a745;
            color: white;
        }
        
        .badge-processing {
            background-color: #ffc107;
            color: #212529;
        }
        
        .badge-shipped {
            background-color: #17a2b8;
            color: white;
        }
        
        .btn-action {
            padding: 5px 10px;
            font-size: 0.8rem;
            border-radius: 5px;
        }
        
        .product-img {
            width: 50px;
            height: 50px;
            object-fit: cover;
            border-radius: 8px;
        }
        
        .quick-action-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            font-weight: 500;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            margin: 10px 5px;
        }
        
        .quick-action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
            color: white;
        }
        
        .header-section {
            background: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        }
        
        @media (max-width: 992px) {
            .stats-summary {
                flex-direction: column !important;
                gap: 16px !important;
            }
            .stat-item.stat-filter {
                padding: 20px 0 14px 0 !important;
                font-size: 1rem !important;
            }
        }
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s ease;
            }
            .sidebar.show {
                transform: translateX(0);
            }
            .main-content {
                margin-left: 0;
                padding: 10px;
            }
            .header-section {
                padding: 14px;
                margin-bottom: 18px;
            }
            .dashboard-card {
                padding: 12px;
                margin-bottom: 18px;
            }
            .stat-item.stat-filter {
                padding: 16px 0 10px 0 !important;
                font-size: 0.95rem !important;
            }
            .stats-summary {
                flex-direction: column !important;
                gap: 10px !important;
            }
            .table-responsive {
                overflow-x: auto;
            }
            .table {
                min-width: 700px;
                font-size: 0.95rem;
            }
            .btn-action, .btn {
                font-size: 0.95rem !important;
                padding: 4px 8px !important;
            }
            .mobile-toggle {
                display: block !important;
            }
        }
        
        .mobile-toggle {
            display: none;
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 1001;
            background: #667eea;
            color: white;
            border: none;
            padding: 10px;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <!-- Mobile Toggle Button -->
    <button class="mobile-toggle btn" onclick="toggleSidebar()">
        <i class="fas fa-bars"></i>
    </button>

    <!-- Order Detail Modal (วางไว้ใต้ body โดยตรง) -->
    <!-- Tracking Number Modal -->
    <div class="modal fade" id="trackingModal" tabindex="-1" aria-labelledby="trackingModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content" style="border-radius: 16px;">
          <div class="modal-header" style="background: linear-gradient(90deg, #ffc107 0%, #fffbe7 100%); border-top-left-radius: 16px; border-top-right-radius: 16px;">
            <h5 class="modal-title" id="trackingModalLabel"><i class="fas fa-truck me-2 text-warning"></i>กรอกเลขพัสดุ</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <form id="trackingForm">
              <div class="mb-3">
                <label for="trackingInput" class="form-label">เลขพัสดุ/Tracking Number <span class="text-danger">*</span></label>
                <input type="text" class="form-control" id="trackingInput" required autocomplete="off">
                <div class="invalid-feedback">กรุณากรอกเลขพัสดุ</div>
              </div>
              <input type="hidden" id="trackingOrderId">
              <button type="submit" class="btn btn-warning w-100"><i class="fas fa-truck"></i> ยืนยันเลขพัสดุและเปลี่ยนสถานะ</button>
            </form>
          </div>
        </div>
      </div>
    </div>
    <div class="modal fade" id="orderDetailModal" tabindex="-1" aria-labelledby="orderDetailModalLabel" aria-hidden="true" style="z-index: 2000;">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content" style="border-radius: 18px; box-shadow: 0 8px 32px rgba(102,126,234,0.18);">
          <div class="modal-header" style="background: linear-gradient(90deg, #667eea 0%, #764ba2 100%); color: #fff; border-top-left-radius: 18px; border-top-right-radius: 18px;">
            <h5 class="modal-title d-flex align-items-center gap-2" id="orderDetailModalLabel">
              <i class="fas fa-receipt me-2"></i> รายละเอียดคำสั่งซื้อ
            </h5>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body px-4 py-3" id="orderDetailBody" style="background: #f8f9fa;">
            <!-- รายละเอียดจะถูกเติมโดย JS -->
          </div>
          <div class="modal-footer" style="background: #f4f6fb; border-bottom-left-radius: 18px; border-bottom-right-radius: 18px;">
            <button type="button" class="btn btn-gradient-primary w-100" data-bs-dismiss="modal" style="background: linear-gradient(90deg, #667eea 0%, #764ba2 100%); color: #fff; border: none; border-radius: 8px; font-weight: 500;">ปิด</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Sidebar -->
    <nav class="sidebar" id="sidebar">
        <div class="store-logo">
            <div class="mb-3">
                <i class="fas fa-store fa-3x text-white"></i>
            </div>
            <h4>ร้านของใบเตย</h4>
        </div>
        
        <ul class="nav flex-column mt-4">
            <li class="nav-item">
                <a class="nav-link active" href="seller-main.html">
                    <i class="fas fa-tachometer-alt"></i>หน้าแรก
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="seller-product.html">
                    <i class="fas fa-box"></i>สินค้าทั้งหมด
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="seller-orders.html">
                    <i class="fas fa-shopping-cart"></i>คำสั่งซื้อ
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="seller-stock.html">
                    <i class="fas fa-warehouse"></i>สต็อกสินค้า
                </a>
            </li>

            <li class="nav-item">
                <a class="nav-link" href="seller-dashboard.html">
                    <i class="fas fa-chart-line"></i>รายงานยอดขาย
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="seller-edit-store.html">
                    <i class="fas fa-cog"></i>ตั้งค่าร้านค้า
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="index.html">
                    <i class="fas fa-sign-out-alt"></i>ออกจากระบบ
                </a>
            </li>
        </ul>
    </nav>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Header Section -->
        <div class="header-section">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h2 class="mb-0">
                        <i class="fas fa-tachometer-alt text-primary me-2"></i>
                        หน้าหลักผู้ขาย
                    </h2>
                    <p class="text-muted mb-0">ยินดีต้อนรับสู่ระบบจัดการร้านค้า</p>
                </div>
                <div class="col-md-4 text-end">
                    <span class="badge bg-success fs-6">
                        <i class="fas fa-circle"></i> ออนไลน์
                    </span>
                </div>
            </div>
        </div>

        <!-- Dashboard Stats -->
        <div class="stats-summary mb-4" id="orderStatsFilter" style="display: flex; gap: 32px; justify-content: space-between;">
            <div class="stat-item stat-filter active" data-status="all" onclick="setActiveStat(this);filterOrders(0, this)" style="flex:1; background:#fff; border-radius:20px; box-shadow:0 2px 12px rgba(0,0,0,0.06); padding:32px 0 20px 0; text-align:center; cursor:pointer; border:2px solid #3b82f6; transition:box-shadow .2s, border .2s;">
                <div style="font-size:2rem; font-weight:700; color:#222;"> <span id="stat-all">1</span> </div>
                <div style="font-size:1.1rem; color:#444; margin-top:2px;">ทั้งหมด</div>
            </div>
            <div class="stat-item stat-filter" data-status="new" onclick="setActiveStat(this);filterOrders(1, this)" style="flex:1; background:#fff; border-radius:20px; box-shadow:0 2px 12px rgba(0,0,0,0.06); padding:32px 0 20px 0; text-align:center; cursor:pointer; border:2px solid transparent; transition:box-shadow .2s, border .2s;">
                <div style="font-size:2rem; font-weight:700; color:#219150;"> <span id="stat-new">1</span> </div>
                <div style="font-size:1.1rem; color:#219150; margin-top:2px;">คำสั่งซื้อใหม่</div>
            </div>
            <div class="stat-item stat-filter" data-status="processing" onclick="setActiveStat(this);filterOrders(2, this)" style="flex:1; background:#fff; border-radius:20px; box-shadow:0 2px 12px rgba(0,0,0,0.06); padding:32px 0 20px 0; text-align:center; cursor:pointer; border:2px solid transparent; transition:box-shadow .2s, border .2s;">
                <div style="font-size:2rem; font-weight:700; color:#ffc107;"> <span id="stat-processing">0</span> </div>
                <div style="font-size:1.1rem; color:#ffc107; margin-top:2px;">รอจัดส่ง</div>
            </div>
            <div class="stat-item stat-filter" data-status="shipped" onclick="setActiveStat(this);filterOrders(3, this)" style="flex:1; background:#fff; border-radius:20px; box-shadow:0 2px 12px rgba(0,0,0,0.06); padding:32px 0 20px 0; text-align:center; cursor:pointer; border:2px solid transparent; transition:box-shadow .2s, border .2s;">
                <div style="font-size:2rem; font-weight:700; color:#00bcd4;"> <span id="stat-shipped">0</span> </div>
                <div style="font-size:1.1rem; color:#00bcd4; margin-top:2px;">กำลังจัดส่ง</div>
            </div>
            <div class="stat-item stat-filter" data-status="success" onclick="setActiveStat(this);filterOrders(4, this)" style="flex:1; background:#fff; border-radius:20px; box-shadow:0 2px 12px rgba(0,0,0,0.06); padding:32px 0 20px 0; text-align:center; cursor:pointer; border:2px solid transparent; transition:box-shadow .2s, border .2s;">
                <div style="font-size:2rem; font-weight:700; color:#888;"> <span id="stat-success">0</span> </div>
                <div style="font-size:1.1rem; color:#888; margin-top:2px;">สำเร็จแล้ว</div>
            </div>
            <div class="stat-item stat-filter" data-status="cancel" onclick="setActiveStat(this);filterOrders(5, this)" style="flex:1; background:#fff; border-radius:20px; box-shadow:0 2px 12px rgba(0,0,0,0.06); padding:32px 0 20px 0; text-align:center; cursor:pointer; border:2px solid transparent; transition:box-shadow .2s, border .2s;">
                <div style="font-size:2rem; font-weight:700; color:#e53935;"> <span id="stat-cancel">0</span> </div>
                <div style="font-size:1.1rem; color:#e53935; margin-top:2px;">ยกเลิก</div>
            </div>
        </div>

        <div class="row">
            <!-- Recent Orders -->
            <div class="col-12 mb-4" style="margin-bottom: 30px !important;">
                <div class="dashboard-card">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h5><i class="fas fa-shopping-cart text-primary"></i> คำสั่งซื้อใหม่ล่าสุด</h5>
                        <a href="seller-orders.html" class="btn btn-outline-primary btn-sm">ดูทั้งหมด</a>
                    </div>
                    
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>หมายเลขคำสั่ง</th>
                                    <th>สินค้า</th>
                                    <th>ค่าสายตาซ้าย</th>
                                    <th>ค่าสายตาขวา</th>
                                    <th>จำนวน</th>
                                    <th>ยอดรวม</th>
                                    <th>วิธีการชำระเงิน</th>
                                    <th>สถานะ</th>
                                    <th>การจัดการ</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr id="order-ORD-001">
                                    <td><strong>ORD-001</strong></td>
                                    <td>คอนแทคเลนส์แบบใส</td>
                                    <td>-2.50</td>
                                    <td>-3.00</td>
                                    <td>2 ชิ้น</td>
                                    <td><strong>฿1,200</strong></td>
                                    <td>โอนชำระ</td>
                                    <td id="status-ORD-001">
                                        <span class="badge badge-status badge-new">
                                            <i class="fas fa-clock"></i> คำสั่งซื้อใหม่
                                        </span>
                                    </td>
                                    <td id="actions-ORD-001">
                                        <button class="btn btn-primary btn-action" onclick="viewOrder('ORD-001')">
                                            <i class="fas fa-eye"></i> ดู
                                        </button>
                                        <button class="btn btn-success btn-action" onclick="updateOrderStatus('ORD-001', 2)">
                                            <i class="fas fa-check"></i> ยืนยันรับออเดอร์
                                        </button>
                                        <button class="btn btn-danger btn-action" onclick="updateOrderStatus('ORD-001', 5)">
                                            <i class="fas fa-times"></i> ยกเลิก
                                        </button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
                <!-- Popular Products 
                <div class="dashboard-card mb-4">
                    <h5><i class="fas fa-fire text-danger"></i> สินค้ายอดนิยม</h5>
                    
                    <div class="row mb-3">
                        <div class="col-4">
                            <img src="https://via.placeholder.com/100x100?text=Product1" alt="สินค้า 1" class="product-img w-100">
                        </div>
                        <div class="col-8">
                            <strong>เสื้อยืดผ้าฝ้าย</strong><br>
                            <small class="text-muted">ขายแล้ว 45 ชิ้น</small><br>
                            <span class="text-success">฿299</span>
                        </div>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-4">
                            <img src="https://via.placeholder.com/100x100?text=Product2" alt="สินค้า 2" class="product-img w-100">
                        </div>
                        <div class="col-8">
                            <strong>กางเกงยีนส์</strong><br>
                            <small class="text-muted">ขายแล้ว 32 ชิ้น</small><br>
                            <span class="text-success">฿890</span>
                        </div>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-4">
                            <img src="https://via.placeholder.com/100x100?text=Product3" alt="สินค้า 3" class="product-img w-100">
                        </div>
                        <div class="col-8">
                            <strong>รองเท้าผ้าใบ</strong><br>
                            <small class="text-muted">ขายแล้ว 28 ชิ้น</small><br>
                            <span class="text-success">฿1,590</span>
                        </div>
                    </div>
                </div>-->

                <!-- Low Stock Alert 
                <div class="dashboard-card mb-4">
                    <h5><i class="fas fa-exclamation-triangle text-warning"></i> สินค้าใกล้หมด</h5>
                    
                    <div class="row mb-3">
                        <div class="col-4">
                            <img src="https://via.placeholder.com/100x100?text=Product4" alt="สินค้า 4" class="product-img w-100">
                        </div>
                        <div class="col-8">
                            <strong>หมวกแก๊ป</strong><br>
                            <small class="text-danger">เหลือ 3 ชิ้น</small><br>
                            <span class="text-success">฿450</span>
                        </div>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-4">
                            <img src="https://via.placeholder.com/100x100?text=Product5" alt="สินค้า 5" class="product-img w-100">
                        </div>
                        <div class="col-8">
                            <strong>เข็มขัดหนัง</strong><br>
                            <small class="text-danger">เหลือ 1 ชิ้น</small><br>
                            <span class="text-success">฿680</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>-->

        <!-- Quick Actions -->
        <!--<div class="dashboard-card">
            <h5><i class="fas fa-bolt text-warning"></i> ทางลัดการจัดการ</h5>
            <div class="text-center">
                <a href="#" class="quick-action-btn">
                    <i class="fas fa-plus-circle"></i> เพิ่มสินค้าใหม่
                </a>
                <a href="seller-edit-store.html" class="quick-action-btn">
                    <i class="fas fa-store"></i> จัดการร้านค้า
                </a>
                <a href="#" class="quick-action-btn">
                    <i class="fas fa-chart-bar"></i> ดูรายงาน
                </a>
                <a href="#" class="quick-action-btn">
                    <i class="fas fa-warehouse"></i> จัดการสต็อก
                </a>
            </div>
        </div>-->
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <script>
        function setActiveStat(el) {
            document.querySelectorAll('.stat-item.stat-filter').forEach(item => {
                item.classList.remove('active');
                item.style.border = '2px solid transparent';
            });
            el.classList.add('active');
            el.style.border = '2px solid #3b82f6';
        }
    </script>
    <script>
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('show');
        }

        function viewOrder(orderId) {
            // mockup: ดึงข้อมูลจาก row ในตาราง (จริงควรดึงจากฐานข้อมูลหรือ API)
            const row = document.getElementById('order-' + orderId);
            // กรณีนี้มีแค่ 1 ออเดอร์ mockup
            const order = {
                id: 'ORD-001',
                product: 'คอนแทคเลนส์แบบใส',
                left: '-2.50',
                right: '-3.00',
                qty: '2 ชิ้น',
                total: '฿1,200',
                payment: 'โอนชำระ',
                status: 'คำสั่งซื้อใหม่',
                customer: 'นางสาวอันนา สมิท',
                email: 'anna.smith@email.com',
                address: '123 ถนนสุขุมวิท กรุงเทพฯ 10110'
            };
            // ตรวจสอบสถานะจริงจาก DOM (mockup ใช้ order.status)
            let statusText = 'คำสั่งซื้อใหม่';
            if (row) {
                const badge = row.querySelector('td[id^="status-"] .badge');
                if (badge) {
                    statusText = badge.textContent.trim();
                }
            }
            let actionHtml = '';
            if(statusText.includes('คำสั่งซื้อใหม่')) {
                actionHtml = `
                  <button class="btn btn-success me-2" style="min-width:120px;" onclick="updateOrderStatus('${order.id}', 2);bootstrap.Modal.getInstance(document.getElementById('orderDetailModal')).hide();">
                    <i class="fas fa-check"></i> ยืนยันรับออเดอร์
                  </button>
                  <button class="btn btn-danger" style="min-width:100px;" onclick="updateOrderStatus('${order.id}', 5);bootstrap.Modal.getInstance(document.getElementById('orderDetailModal')).hide();">
                    <i class="fas fa-times"></i> ยกเลิก
                  </button>
                `;
            } else if(statusText.includes('รอจัดส่ง')) {
                actionHtml = `
                  <button class="btn btn-info me-2" style="min-width:120px;" onclick="showTrackingModal('${order.id}');bootstrap.Modal.getInstance(document.getElementById('orderDetailModal')).hide();">
                    <i class="fas fa-truck"></i> กำลังจัดส่ง
                  </button>
                  <button class="btn btn-danger" style="min-width:100px;" onclick="updateOrderStatus('${order.id}', 5);bootstrap.Modal.getInstance(document.getElementById('orderDetailModal')).hide();">
                    <i class="fas fa-times"></i> ยกเลิก
                  </button>
                `;
            } else if(statusText.includes('กำลังจัดส่ง')) {
                actionHtml = `
                  <button class="btn btn-success" style="min-width:140px;" onclick="updateOrderStatus('${order.id}', 4);bootstrap.Modal.getInstance(document.getElementById('orderDetailModal')).hide();">
                    <i class="fas fa-check-double"></i> จัดส่งเรียบร้อย
                  </button>
                `;
            } else if(statusText.includes('จัดส่งเรียบร้อย')) {
                actionHtml = `<span class='text-success'><i class='fas fa-check-circle'></i> เสร็จสิ้น</span>`;
            } else if(statusText.includes('ยกเลิก')) {
                actionHtml = `<span class='text-danger'><i class='fas fa-times'></i> ออเดอร์ถูกยกเลิก</span>`;
            }

            let html = `
                <div class="d-flex align-items-center mb-3" style="gap: 12px;">
                  <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: #fff; border-radius: 10px; width: 48px; height: 48px; display: flex; align-items: center; justify-content: center; font-size: 1.7rem;">
                    <i class="fas fa-box"></i>
                  </div>
                  <div>
                    <div style="font-size: 1.1rem; font-weight: 600; color: #333;">${order.product}</div>
                    <div style="font-size: 0.95rem; color: #888;">หมายเลขคำสั่ง: <span style="color:#764ba2; font-weight:500;">${order.id}</span></div>
                  </div>
                </div>
                <hr style="margin: 0.7rem 0 1.1rem 0; border-top: 1.5px solid #e0e3ea;">
                <div class="row mb-2">
                  <div class="col-6 mb-2"><strong><i class="fas fa-eye me-1"></i> ค่าสายตาซ้าย:</strong> <span class="text-primary">${order.left}</span></div>
                  <div class="col-6 mb-2"><strong><i class="fas fa-eye me-1"></i> ค่าสายตาขวา:</strong> <span class="text-primary">${order.right}</span></div>
                  <div class="col-6 mb-2"><strong><i class="fas fa-layer-group me-1"></i> จำนวน:</strong> ${order.qty}</div>
                  <div class="col-6 mb-2"><strong><i class="fas fa-coins me-1"></i> ยอดรวม:</strong> <span class="text-success">${order.total}</span></div>
                  <div class="col-6 mb-2"><strong><i class="fas fa-credit-card me-1"></i> วิธีการชำระเงิน:</strong> ${order.payment}</div>
                  <div class="col-6 mb-2"><strong><i class="fas fa-info-circle me-1"></i> สถานะ:</strong> <span class="badge bg-success" style="font-size:0.95rem;">${statusText}</span></div>
                </div>
                <hr style="margin: 0.7rem 0 1.1rem 0; border-top: 1.5px solid #e0e3ea;">
                <div class="mb-2"><strong><i class="fas fa-user me-1"></i> ลูกค้า:</strong> ${order.customer}</div>
                <div class="mb-2"><strong><i class="fas fa-envelope me-1"></i> อีเมล:</strong> ${order.email}</div>
                <div class="mb-2"><strong><i class="fas fa-map-marker-alt me-1"></i> ที่อยู่จัดส่ง:</strong> ${order.address}</div>
                <div class="mt-4 d-flex flex-wrap gap-2 justify-content-center">${actionHtml}</div>
            `;
            document.getElementById('orderDetailBody').innerHTML = html;
            var modal = new bootstrap.Modal(document.getElementById('orderDetailModal'));
            modal.show();
        }

        // ฟิลเตอร์ออเดอร์ตามสถานะ
        function filterOrders(status) {
            const rows = document.querySelectorAll('tbody tr');
            rows.forEach(row => {
                // mockup: ตรวจสอบสถานะจาก badge ใน td
                const statusTd = row.querySelector('td[id^="status-"]');
                if (!statusTd) return;
                let show = true;
                if (status !== 0) {
                    if (status === 1 && !statusTd.innerHTML.includes('คำสั่งซื้อใหม่')) show = false;
                    else if (status === 2 && !statusTd.innerHTML.includes('รอจัดส่ง')) show = false;
                    else if (status === 3 && !statusTd.innerHTML.includes('กำลังจัดส่ง')) show = false;
                    else if (status === 4 && !statusTd.innerHTML.includes('จัดส่งเรียบร้อย')) show = false;
                    else if (status === 5 && !statusTd.innerHTML.includes('ยกเลิก')) show = false;
                }
                row.style.display = show ? '' : 'none';
            });
        }

        // สถานะ: 1=ใหม่, 2=รอจัดส่ง, 3=กำลังจัดส่ง, 4=จัดส่งเรียบร้อย, 5=ยกเลิก
        function updateOrderStatus(orderId, nextStatus) {
            const statusCell = document.getElementById('status-' + orderId);
            const actionsCell = document.getElementById('actions-' + orderId);
            let statusHtml = '';
            let actionsHtml = '';
            // Update status cell and actions cell
            const viewBtn = `<button class="btn btn-primary btn-action" onclick="viewOrder('${orderId}')"><i class="fas fa-eye"></i> ดู</button> `;
            if (nextStatus === 2) {
                statusHtml = `<span class=\"badge badge-status badge-processing\"><i class='fas fa-box'></i> รอจัดส่ง</span>`;
                actionsHtml = viewBtn + `<button class='btn btn-info btn-action' onclick=\"showTrackingModal('${orderId}')\"><i class='fas fa-truck'></i> กำลังจัดส่ง</button> ` +
                              `<button class='btn btn-danger btn-action' onclick=\"updateOrderStatus('${orderId}',5)\"><i class='fas fa-times'></i> ยกเลิก</button>`;
            } else if (nextStatus === 3) {
                // ต้องมีเลขพัสดุถึงจะเปลี่ยนสถานะนี้ได้ (ป้องกันเรียกตรง)
                const tracking = statusCell.getAttribute('data-tracking');
                if (!tracking) {
                    showTrackingModal(orderId);
                    return;
                }
                statusHtml = `<span class=\"badge badge-status badge-shipped\"><i class='fas fa-truck'></i> กำลังจัดส่ง <span class='ms-1 badge bg-light text-dark' style='font-size:0.85em;'>${tracking}</span></span>`;
                actionsHtml = viewBtn + `<button class='btn btn-success btn-action' onclick=\"updateOrderStatus('${orderId}',4)\"><i class='fas fa-check-double'></i> จัดส่งเรียบร้อย</button>`;
            } else if (nextStatus === 4) {
                statusHtml = `<span class=\"badge bg-success\"><i class='fas fa-check-circle'></i> จัดส่งเรียบร้อย</span>`;
                actionsHtml = viewBtn + `<span class='text-success'>เสร็จสิ้น</span>`;
            } else if (nextStatus === 5) {
                statusHtml = `<span class=\"badge bg-danger\"><i class='fas fa-times'></i> ยกเลิก</span>`;
                actionsHtml = viewBtn + `<span class='text-danger'>ออเดอร์ถูกยกเลิก</span>`;
            } else {
                // สถานะใหม่ (1)
                actionsHtml = viewBtn + `<button class='btn btn-success btn-action' onclick=\"updateOrderStatus('${orderId}',2)\"><i class='fas fa-check'></i> ยืนยันรับออเดอร์</button> ` +
                              `<button class='btn btn-danger btn-action' onclick=\"updateOrderStatus('${orderId}',5)\"><i class='fas fa-times'></i> ยกเลิก</button>`;
            }
            statusCell.innerHTML = statusHtml;
            actionsCell.innerHTML = actionsHtml;
            // Update stats
            updateStats(nextStatus);
        }

        function updateStats(currentStatus) {
            document.getElementById('stat-all').innerText = '0';
            document.getElementById('stat-new').innerText = '0';
            document.getElementById('stat-processing') && (document.getElementById('stat-processing').innerText = '0');
            document.getElementById('stat-shipped').innerText = '0';
            document.getElementById('stat-success').innerText = '0';
            document.getElementById('stat-cancel').innerText = '0';

            if (currentStatus === 1) {
                document.getElementById('stat-all').innerText = '1';
                document.getElementById('stat-new').innerText = '1';
            } else if (currentStatus === 2) {
                document.getElementById('stat-all').innerText = '1';
                document.getElementById('stat-processing').innerText = '1';
            } else if (currentStatus === 3) {
                document.getElementById('stat-all').innerText = '1';
                document.getElementById('stat-shipped').innerText = '1';
            } else if (currentStatus === 4) {
                document.getElementById('stat-all').innerText = '1';
                document.getElementById('stat-success').innerText = '1';
            } else if (currentStatus === 5) {
                document.getElementById('stat-all').innerText = '1';
                document.getElementById('stat-cancel').innerText = '1';
            }
        }

        // Close sidebar when clicking outside on mobile
        document.addEventListener('click', function(event) {
            const sidebar = document.getElementById('sidebar');
            const toggleBtn = document.querySelector('.mobile-toggle');
            if (window.innerWidth <= 768 && 
                !sidebar.contains(event.target) && 
                !toggleBtn.contains(event.target) && 
                sidebar.classList.contains('show')) {
                sidebar.classList.remove('show');
            }
        });

        // Auto-refresh dashboard data every 30 seconds
        setInterval(function() {
            // Here you would typically make an AJAX call to refresh the data
            console.log('Refreshing dashboard data...');
        }, 30000);

        // ตั้งค่าเริ่มต้นให้สถิติแสดง "คำสั่งซื้อใหม่" 1 รายการ
        updateStats(1);

        // Modal tracking logic
        function showTrackingModal(orderId) {
            document.getElementById('trackingOrderId').value = orderId;
            document.getElementById('trackingInput').value = '';
            document.getElementById('trackingInput').classList.remove('is-invalid');
            var modal = new bootstrap.Modal(document.getElementById('trackingModal'));
            modal.show();
        }

        document.getElementById('trackingForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const tracking = document.getElementById('trackingInput').value.trim();
            const orderId = document.getElementById('trackingOrderId').value;
            if (!tracking) {
                document.getElementById('trackingInput').classList.add('is-invalid');
                return;
            }
            // ใส่ tracking ลงใน data-tracking ของ status cell
            const statusCell = document.getElementById('status-' + orderId);
            statusCell.setAttribute('data-tracking', tracking);
            // ปิด modal
            bootstrap.Modal.getInstance(document.getElementById('trackingModal')).hide();
            // เปลี่ยนสถานะเป็นกำลังจัดส่ง
            updateOrderStatus(orderId, 3);
        });
    </script>
</body>
</html>
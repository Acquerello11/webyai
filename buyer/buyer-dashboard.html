<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Alice Moist Daily</title>
  <link href="https://fonts.googleapis.com/css2?family=Kanit&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="css/navbar-footer-style.css">
  <script src="js/navbar-footer.js" defer></script>
</head>

<body>
<div id="navbar"></div>

<main class="container">
    <section class="product-section" style="display:flex;gap:32px;align-items:flex-start;justify-content:center;background:none;box-shadow:none;padding:40px 0 32px 0;max-width:1100px;margin:auto;">
      <div style="flex:1;min-width:320px;max-width:480px;display:flex;flex-direction:column;align-items:center;justify-content:flex-start;">
        <h1 style="font-family:'Kanit',sans-serif;font-size:2.1rem;font-weight:700;color:#183a7a;margin-bottom:18px;text-align:left;width:100%;"><span style='color:#183a7a;'>Alice</span> <span style='color:#00c300;'>MOIST</span> Daily</h1>
        <div style="width:100%;min-height:400px;display:flex;justify-content:center;align-items:flex-start;">
          <img src="../images/product1.png" alt="Alice Moist Daily Contact Lenses" style="max-width:500px;width:100%;height:auto;display:block;margin-bottom:0;object-fit:contain;">
        </div>
      </div>
      <div style="flex:1;min-width:320px;max-width:420px;background:#fff;border-radius:18px;box-shadow:0 2px 16px rgba(0,0,0,0.09);padding:28px 24px 32px 24px;display:flex;flex-direction:column;align-items:stretch;gap:12px;">
        <h2 style="font-family:'Kanit',sans-serif;font-size:1.35rem;font-weight:700;color:#183a7a;margin-bottom:8px;text-align:left;">Alice <span style='color:#00c300;font-weight:bold;'>MOIST</span> Daily</h2>
        <div style="font-size:1.05rem;color:#223;margin-bottom:10px;">เลนส์สัมผัสชนิดนิ่ม <b style='color:#183a7a;'>อลิซมอยส์เดลี่</b> เป็นคอนแทคเลนส์ใสรายวันที่ใช้ <span style='color:#00c300;font-weight:bold;'>GMMA</span> เป็นตัวรักษาความชุ่มชื้น (Moisturizer) ตลอดวันที่สวมใส่</div>
        <div class="prescription-selection">
          <div style="background:#f7fafd;border-radius:16px;box-shadow:0 2px 12px rgba(24,58,122,0.07);padding:18px 18px 10px 18px;display:flex;flex-direction:column;gap:10px;">
            <div style="display:flex;gap:18px;justify-content:space-between;align-items:flex-start;">
              <div style="flex:1;display:flex;flex-direction:column;gap:18px;">
                <!-- ตาขวา -->
                <div style="display:flex;align-items:center;justify-content:space-between;gap:8px;background:#fff;border-radius:12px;padding:12px 16px 10px 16px;box-shadow:0 1px 6px rgba(24,58,122,0.06);">
                  <div style="flex:1;display:flex;flex-direction:column;align-items:flex-start;">
                    <div style="font-size:1.15rem;font-weight:700;color:#183a7a;margin-bottom:2px;">ตาขวา*</div>
                    <select id="rightEyeSelect" class="eye-dropdown" style="width:100%;max-width:120px;font-size:1.1rem;padding:8px 12px;border-radius:8px;border:2px solid #b5d6e6;margin-top:8px;font-weight:600;">
                      <option value="">-- เลือก --</option>
                      <option value="-0.25">-0.25</option>
                      <option value="-0.50">-0.50</option>
                      <option value="-0.75">-0.75</option>
                      <option value="-1.00">-1.00</option>
                      <option value="-1.25">-1.25</option>
                      <option value="-1.50">-1.50</option>
                      <option value="-1.75">-1.75</option>
                      <option value="-2.00">-2.00</option>
                      <option value="-2.25">-2.25</option>
                      <option value="-2.50">-2.50</option>
                      <option value="-2.75">-2.75</option>
                      <option value="-3.00">-3.00</option>
                      <option value="-3.25">-3.25</option>
                      <option value="-3.50">-3.50</option>
                      <option value="-3.75">-3.75</option>
                      <option value="-4.00">-4.00</option>
                      <option value="-4.25">-4.25</option>
                      <option value="-4.50">-4.50</option>
                      <option value="-4.75">-4.75</option>
                      <option value="-5.00">-5.00</option>
                      <option value="-5.25">-5.25</option>
                      <option value="-5.50">-5.50</option>
                      <option value="-5.75">-5.75</option>
                      <option value="-6.00">-6.00</option>
                    </select>
                    <div style="font-size:0.85rem;color:#888;margin-top:6px;">* กรณีสั่ง 1 ชุด จะได้สายตาขวาเป็นหลัก</div>
                  </div>
                  <div style="width:54px;height:38px;display:flex;align-items:center;justify-content:center;">
                    <svg width="48" height="32" viewBox="0 0 48 32" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <ellipse cx="24" cy="16" rx="22" ry="13" stroke="#183a7a" stroke-width="2"/>
                      <circle cx="24" cy="16" r="7" stroke="#183a7a" stroke-width="2"/>
                      <circle cx="24" cy="16" r="2.5" stroke="#183a7a" stroke-width="2"/>
                    </svg>
                  </div>
                </div>
                <!-- ตาซ้าย -->
                <div style="display:flex;align-items:center;justify-content:space-between;gap:8px;background:#fff;border-radius:12px;padding:12px 16px 10px 16px;box-shadow:0 1px 6px rgba(24,58,122,0.06);">
                  <div style="width:54px;height:38px;display:flex;align-items:center;justify-content:center;">
                    <svg width="48" height="32" viewBox="0 0 48 32" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <ellipse cx="24" cy="16" rx="22" ry="13" stroke="#183a7a" stroke-width="2"/>
                      <circle cx="24" cy="16" r="7" stroke="#183a7a" stroke-width="2"/>
                      <circle cx="24" cy="16" r="2.5" stroke="#183a7a" stroke-width="2"/>
                    </svg>
                  </div>
                  <div style="flex:1;display:flex;flex-direction:column;align-items:flex-end;">
                    <div style="font-size:1.15rem;font-weight:700;color:#183a7a;margin-bottom:2px;">ตาซ้าย</div>
                    <select id="leftEyeSelect" class="eye-dropdown" style="width:100%;max-width:120px;font-size:1.1rem;padding:8px 12px;border-radius:8px;border:2px solid #b5d6e6;margin-top:8px;font-weight:600;">
                      <option value="">-- เลือก --</option>
                      <option value="-0.25">-0.25</option>
                      <option value="-0.50">-0.50</option>
                      <option value="-0.75">-0.75</option>
                      <option value="-1.00">-1.00</option>
                      <option value="-1.25">-1.25</option>
                      <option value="-1.50">-1.50</option>
                      <option value="-1.75">-1.75</option>
                      <option value="-2.00">-2.00</option>
                      <option value="-2.25">-2.25</option>
                      <option value="-2.50">-2.50</option>
                      <option value="-2.75">-2.75</option>
                      <option value="-3.00">-3.00</option>
                      <option value="-3.25">-3.25</option>
                      <option value="-3.50">-3.50</option>
                      <option value="-3.75">-3.75</option>
                      <option value="-4.00">-4.00</option>
                      <option value="-4.25">-4.25</option>
                      <option value="-4.50">-4.50</option>
                      <option value="-4.75">-4.75</option>
                      <option value="-5.00">-5.00</option>
                      <option value="-5.25">-5.25</option>
                      <option value="-5.50">-5.50</option>
                      <option value="-5.75">-5.75</option>
                      <option value="-6.00">-6.00</option>
                    </select>
                  </div>
                </div>
              </div>
            </div>
            <div style="display:flex;align-items:center;gap:12px;margin-top:8px;">
              <span style="font-size:1.05rem;color:#183a7a;font-weight:600;">ต้องการความช่วยเหลือ</span>
              <a href="tel:+66123456789" style="background:#00c300;border-radius:50%;width:32px;height:32px;display:flex;align-items:center;justify-content:center;text-decoration:none;transition:all 0.3s ease;" title="โทรหาเรา">
                <i class="fas fa-phone" style="color:white;font-size:14px;"></i>
              </a>
              <a href="https://line.me/ti/p/~@alicecontactlens" target="_blank" style="background:#00c300;border-radius:50%;width:32px;height:32px;display:flex;align-items:center;justify-content:center;text-decoration:none;transition:all 0.3s ease;" title="แชทไลน์">
                <i class="fab fa-line" style="color:white;font-size:16px;"></i>
              </a>
            </div>
          </div>
        <div class="quantity-selection" id="quantitySelection" style="display: none;">
          <div style="background:#f7fafd;border-radius:16px;box-shadow:0 2px 12px rgba(24,58,122,0.07);padding:18px 18px 10px 18px;margin-top:12px;">
            <div style="display:flex;align-items:center;gap:12px;margin-bottom:10px;">
              <h3 style="font-size:1.15rem;font-weight:700;color:#183a7a;margin:0;">จำนวน</h3>
              <!-- Custom Dropdown -->
              <div class="custom-dropdown" style="position:relative;min-width:200px;">
                <div id="quantitySelectButton" class="dropdown-button" style="font-size:1.1rem;padding:8px 16px;border-radius:8px;border:2px solid #b5d6e6;background:#fff;cursor:pointer;display:flex;justify-content:space-between;align-items:center;font-weight:600;">
                  <span id="selectedQuantityText" data-value="1">1 ชุด (30 เลนส์)</span>
                  <i class="fas fa-chevron-down" style="color:#183a7a;font-size:0.9rem;transition:transform 0.2s;"></i>
                </div>
                <div id="quantityDropdown" class="dropdown-menu" style="position:absolute;top:100%;left:0;right:0;background:#fff;border:2px solid #b5d6e6;border-radius:8px;box-shadow:0 4px 12px rgba(0,0,0,0.1);z-index:1000;display:none;max-height:200px;overflow-y:auto;">
                  <!-- ตัวเลือกจะถูกสร้างโดย JavaScript -->
                </div>
              </div>
            </div>
            <div style="margin-bottom:10px;">
              <span style="font-size:1.0rem;color:#00c300;font-weight:700;">ประหยัดกว่า 14.28% หากซื้อ 4 ชุด</span>
            </div>
            <div class="quantity-details" id="quantityDetails" style="margin-top:10px;">
              <div class="quantity-info" style="display:flex;align-items:center;gap:16px;flex-wrap:wrap;">
                <div class="quantity-price" style="font-size:1.2rem;font-weight:700;color:#183a7a;">
                  <span class="current-price" style="color:#00c300;font-size:1.4rem;font-weight:800;">-- บาท</span>
                  <span class="original-price" style="color:#bbb;text-decoration:line-through;margin-left:8px;font-size:1.1rem;display:none;">1,400.00 บาท</span>
                </div>
                <div class="quantity-note" style="font-size:1.05rem;color:#183a7a;font-weight:600;">เลือกค่าสายตาก่อน</div>
                <div class="quantity-savings" style="font-size:1.05rem;color:#00c300;font-weight:700;display:none;">ประหยัด 100.00 บาท</div>
              </div>
            </div>
          </div>
            </div>
        </div>
        <div class="summary">
            <div class="total-price" style="text-align:center;margin-bottom:16px;font-size:1.2rem;font-weight:600;color:#183a7a;">
                ยอดรวม: <span id="totalPrice">-- บาท</span>
            </div>
            <div class="action-buttons" style="display:flex;justify-content:center;">
        <button class="add-to-cart" onclick="addToCart()" style="width:100%;background:#00c300;color:white;border:none;border-radius:12px;padding:14px 20px;font-size:1.1rem;font-weight:600;cursor:pointer;transition:all 0.3s ease;display:flex;align-items:center;justify-content:center;gap:8px;font-family: 'Kanit', sans-serif;">
          <i class="fas fa-shopping-cart"></i> ใส่ตะกร้า
        </button>
            </div>
        </div>
      </div>
    </section>

</main>
<div id="footer"></div>
<div id="footer"></div>

<script>
  // ข้อมูลราคาตามจำนวนกล่อง
  const packageData = {
    1: {
      price: 700,
      originalPrice: null,
      savings: 0,
      discount: null,
      lenses: 30,
      note: "ตาขวาเป็นหลัก"
    },
    2: {
      price: 1300,
      originalPrice: 1400,
      savings: 100,
      discount: "ประหยัด 7.14%",
      lenses: 60,
      note: "ตาขวา + ตาซ้าย"
    },
    4: {
      price: 2400,
      originalPrice: 2800,
      savings: 400,
      discount: "ประหยัด 14.28%",
      lenses: 120,
      note: "ตาขวา + ตาซ้าย"
    }
  };

  // อัพเดทข้อมูลราคาตามจำนวนที่เลือก
  function updatePriceDisplay(quantity) {
    const data = packageData[quantity];
    const currentPriceEl = document.querySelector('.current-price');
    const originalPriceEl = document.querySelector('.original-price');
    const savingsEl = document.querySelector('.quantity-savings');
    const noteEl = document.querySelector('.quantity-note');
    const totalPriceEl = document.getElementById('totalPrice');

    // อัพเดทราคาปัจจุบัน
    currentPriceEl.textContent = `${data.price.toLocaleString()}.00 บาท`;
    
    // อัพเดทราคาเดิม
    if (data.originalPrice) {
      originalPriceEl.textContent = `${data.originalPrice.toLocaleString()}.00 บาท`;
      originalPriceEl.style.display = 'inline';
    } else {
      originalPriceEl.style.display = 'none';
    }

    // อัพเดทส่วนลด
    if (data.savings > 0) {
      savingsEl.textContent = `ประหยัด ${data.savings.toLocaleString()}.00 บาท`;
      savingsEl.style.display = 'inline-block';
    } else {
      savingsEl.style.display = 'none';
    }

    // อัพเดทหมายเหตุ
    noteEl.textContent = data.note;

    // อัพเดทยอดรวม
    totalPriceEl.textContent = `${data.price.toLocaleString()}.00 บาท`;
  }

  // สร้างตัวเลือกใน dropdown
  function createDropdownOptions() {
    const dropdown = document.getElementById('quantityDropdown');
    const options = [
      { value: 1, text: '1 ชุด (30 เลนส์)', discount: null },
      { value: 2, text: '2 ชุด (60 เลนส์)', discount: 'ประหยัด 7.14%' },
      { value: 4, text: '4 ชุด (120 เลนส์)', discount: 'ประหยัด 14.28%' }
    ];

    dropdown.innerHTML = options.map(option => `
      <div class="dropdown-option" data-value="${option.value}" style="padding:10px 16px;cursor:pointer;transition:background 0.2s;border-bottom:1px solid #f0f0f0;">
        <div>${option.text}</div>
        ${option.discount ? `<div style="color:#00c300;font-size:0.9rem;font-weight:600;">${option.discount}</div>` : ''}
      </div>
    `).join('');

    // เพิ่ม event listeners สำหรับตัวเลือก
    dropdown.querySelectorAll('.dropdown-option').forEach(option => {
      option.addEventListener('mouseenter', () => {
        option.style.background = '#f8f9fa';
      });
      option.addEventListener('mouseleave', () => {
        option.style.background = 'white';
      });
      option.addEventListener('click', () => {
        const value = parseInt(option.getAttribute('data-value'));
        const text = option.querySelector('div').textContent;
        
        // อัพเดทข้อความที่แสดง
        document.getElementById('selectedQuantityText').textContent = text;
        document.getElementById('selectedQuantityText').setAttribute('data-value', value);
        
        // อัพเดทราคา
        updatePriceDisplay(value);
        
        // ปิด dropdown
        dropdown.style.display = 'none';
        document.querySelector('.fas.fa-chevron-down').style.transform = 'rotate(0deg)';
      });
    });
  }

  // จัดการการเปิด/ปิด dropdown
  function setupDropdown() {
    const button = document.getElementById('quantitySelectButton');
    const dropdown = document.getElementById('quantityDropdown');
    const chevron = document.querySelector('.fas.fa-chevron-down');

    button.addEventListener('click', (e) => {
      e.stopPropagation();
      const isOpen = dropdown.style.display === 'block';
      
      if (isOpen) {
        dropdown.style.display = 'none';
        chevron.style.transform = 'rotate(0deg)';
      } else {
        dropdown.style.display = 'block';
        chevron.style.transform = 'rotate(180deg)';
      }
    });

    // ปิด dropdown เมื่อคลิกที่อื่น
    document.addEventListener('click', () => {
      dropdown.style.display = 'none';
      chevron.style.transform = 'rotate(0deg)';
    });
  }

  // แสดง quantity selection เมื่อเลือกสายตาครบ
  function checkEyeSelection() {
    const rightEye = document.getElementById('rightEyeSelect').value;
    const leftEye = document.getElementById('leftEyeSelect').value;
    const quantitySelection = document.getElementById('quantitySelection');

    if (rightEye && rightEye !== '') {
      quantitySelection.style.display = 'block';
      
      // ตั้งค่าเริ่มต้นเป็น 1 ชุด
      updatePriceDisplay(1);
    } else {
      quantitySelection.style.display = 'none';
    }
  }

  // เริ่มต้นเมื่อหน้าเว็บโหลดเสร็จ
  document.addEventListener('DOMContentLoaded', function() {
    createDropdownOptions();
    setupDropdown();
    
    // เพิ่ม event listeners สำหรับ eye selection
    document.getElementById('rightEyeSelect').addEventListener('change', checkEyeSelection);
    document.getElementById('leftEyeSelect').addEventListener('change', checkEyeSelection);
  });

  // ดึงข้อมูล user จาก API และแสดงชื่อผู้ใช้บน dashboard
  const API_BASE_URL = 'http://localhost:3000';
  const buyerEmail = localStorage.getItem('buyer_email');
  if (buyerEmail) {
    fetch(`${API_BASE_URL}/api/user?email=${encodeURIComponent(buyerEmail)}`)
      .then(res => res.json())
      .then(data => {
        if (data.user_name) {
          // สร้าง element แสดงชื่อผู้ใช้ด้านบน dashboard
          const userInfoDiv = document.createElement('div');
          userInfoDiv.style = 'width:100%;text-align:right;padding:8px 0 0 0;font-size:1.08rem;color:#183a7a;font-weight:500;';
          userInfoDiv.innerHTML = `<i class='fas fa-user' style='margin-right:6px;color:#00c300;'></i> สวัสดี, ${data.user_name}`;
          document.body.insertBefore(userInfoDiv, document.body.firstChild.nextSibling);
        }
      });
  }

  // --- Popup for cart exists or not login ---
  function showCartExistsPopup() {
    // Remove old popup if exists
    const old = document.getElementById('cartExistsPopup');
    if (old) old.remove();
    const popup = document.createElement('div');
    popup.id = 'cartExistsPopup';
    popup.style = 'position:fixed;z-index:9999;top:0;left:0;width:100vw;height:100vh;background:rgba(24,58,122,0.13);display:flex;align-items:center;justify-content:center;';
    popup.innerHTML = `
      <div style="background:#fff;border-radius:18px;box-shadow:0 2px 16px rgba(24,58,122,0.13);padding:38px 32px 32px 32px;max-width:340px;width:90vw;display:flex;flex-direction:column;align-items:center;position:relative;">
        <button onclick="document.getElementById('cartExistsPopup').remove()" style="position:absolute;top:18px;right:18px;background:none;border:none;font-size:1.3rem;color:#183a7a;cursor:pointer;"><i class='fas fa-times'></i></button>
        <div style="font-size:1.35rem;font-weight:700;color:#183a7a;text-align:center;margin-bottom:10px;">คุณมีสินค้าอยู่ในตะกร้าแล้ว</div>
        <div style="font-size:1.05rem;color:#223;text-align:center;margin-bottom:22px;">กรุณายกเลิกที่ตะกร้าหากต้องการสั่งสินค้าใหม่</div>
        <button onclick="window.location.href='buyer-cart.html'" style="background:#183a7a;color:#fff;border:none;border-radius:8px;padding:10px 28px;font-size:1.08rem;font-weight:600;cursor:pointer;">ไปที่รถเข็น</button>
      </div>
    `;
    document.body.appendChild(popup);
  }

  // --- Add to cart logic ---
  function addToCart() {
    // ถ้า logout (ไม่มี buyer_email ใน localStorage) ให้แสดง popup ทันที
    if (!localStorage.getItem('buyer_email')) {
      showCartExistsPopup();
      return;
    }
    // ตรวจสอบว่ามีสินค้าในตะกร้าอยู่แล้วหรือไม่ (ยังไม่ได้ชำระเงิน)
    // สมมติใช้ localStorage.cartItems เป็น array ของสินค้าในตะกร้า
    // --- ตรวจสอบตะกร้าจริงแบบใช้งานได้จริง ---
    // ใช้ buyer_email เป็น key หลัก เช่น cart_{buyer_email}
    const buyerEmail = localStorage.getItem('buyer_email');
    let cartKey = buyerEmail ? `cart_${buyerEmail}` : null;
    let cartObj = null;
    if (cartKey) {
      try {
        cartObj = JSON.parse(localStorage.getItem(cartKey));
      } catch (e) {
        cartObj = null;
      }
    }
    // โครงสร้าง cartObj: { items: [...], status: 'pending' | 'paid' | ... }
    if (cartObj && Array.isArray(cartObj.items) && cartObj.items.length > 0 && (!cartObj.status || cartObj.status === 'pending')) {
      // มีสินค้าในตะกร้าและยังไม่ได้ชำระเงิน
      showCartExistsPopup();
      return;
    }
    // ...existing logic for add to cart...
    // (คุณสามารถใส่ logic เดิมไว้ตรงนี้)
  }
</script>
</body>
</html>
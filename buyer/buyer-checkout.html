<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Alice Moist Daily - ชำระเงิน</title>
  <link href="https://fonts.googleapis.com/css2?family=Kanit&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    .input-group {
      display: flex;
      gap: 12px;
      width: 100%;
    }
    .input-group.city-province-postal {
      display: flex;
      gap: 12px;
      width: 100%;
    }
    .input-group.city-province-postal > * {
      flex: 1 1 0;
      min-width: 0;
    }
     @media (max-width: 706px) {
      .input-group.city-province-postal {
        flex-direction: column !important;
        gap: 12px !important;
      }
      .input-group.city-province-postal > * {
        width: 100% !important;
        min-width: 0 !important;
        margin-right: 0 !important;
        box-sizing: border-box;
      }
    }
    /* Error message styles */
    .error-message {
      color: #d32f2f;
      font-size: 0.98rem;
      margin-top: 4px;
      margin-bottom: 2px;
      min-height: 18px;
      font-family: 'Kanit', sans-serif;
      transition: all 0.3s ease;
      opacity: 1;
      height: auto;
    }
    .input-error {
      border-color: #d32f2f !important;
      box-shadow: 0 0 0 2px #ffe0e0 !important;
    }
    .error-message.hide {
      opacity: 0;
      height: 0;
      margin: 0;
      padding: 0;
      overflow: hidden;
    }

    /* Global styles */
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Kanit', sans-serif;
      background: #f0f8ff;
      color: #2c3e50;
      line-height: 1.6;
      min-height: 100vh;
    }
    
    /* Navbar */
    .navbar {
      display: flex;
      justify-content: center;
      align-items: center;
      background: linear-gradient(135deg, #183a7a, #2980b9);
      padding: 0 5vw;
      color: white;
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
      height: 70px;
      width: 100%;
      max-width: 100vw;
      box-sizing: border-box;
    }
    @media (max-width: 900px) {
      .navbar {
        height: 54px;
        padding: 0 2vw;
      }
      .navbar-logo {
        height: 44px;
      }
      .navbar-center span {
        font-size: 1rem !important;
      }
    }
    @media (max-width: 600px) {
      .navbar {
        height: 44px;
        padding: 0 1vw;
      }
      .navbar-logo {
        height: 32px;
      }
      .navbar-center span {
        font-size: 0.95rem !important;
      }
    }
    .navbar-center {
      font-size: 32px;
      font-weight: bold;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .navbar-center img {
      height: 60px;
      width: auto;
      border-radius: 35px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      background-color: #ffffff;
      transition: transform 0.3s ease;
    }
    .navbar-center img:hover {
      transform: scale(1.05);
    }
    
    /* Container */
    .container {
      display: flex;
      flex-wrap: wrap;
      gap: 32px;
      max-width: 1200px;
      margin: 30px auto;
      padding: 20px;
      min-height: calc(100vh - 180px);
    }
    
    /* Checkout page */
    .checkout-left, .checkout-right {
      flex: 1 1 400px;
      min-width: 300px;
      background: #fff;
      border-radius: 10px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.05);
      padding: 25px;
      margin-bottom: 25px;
    }
    /* เพิ่มระยะห่างระหว่างส่วนต่างๆ */
    .checkout-section {
      margin-bottom: 40px;
    }
    
    /* Section title */
    .section-title {
      font-size: 1.4rem;
      color: #0077b6;
      margin-bottom: 25px;
      padding-bottom: 10px;
      border-bottom: 2px solid #f0f8ff;
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: relative;
    }
    
    /* ปุ่มเพิ่มที่อยู่ใหม่ */
    .add-address-btn {
      background: #183a7a;
      color: white;
      border: none;
      padding: 8px 15px;
      border-radius: 5px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 0.95rem;
      transition: all 0.3s;
    }
    .add-address-btn:hover {
      background: #142e5c;
      transform: translateY(-2px);
    }
    .add-address-btn i {
      font-size: 0.9rem;
    }
    
    /* Cart items */
    .cart-item {
      display: flex;
      padding: 20px 0;
      border-bottom: 1px solid #eee;
      margin-bottom: 15px;
    }
    .cart-item img {
      width: 80px;
      height: 80px;
      object-fit: contain;
      border-radius: 8px;
      margin-right: 15px;
      background: #f8f9fa;
      padding: 5px;
    }
    .cart-item-details {
      flex: 1;
    }
    .cart-item-title {
      font-weight: bold;
      margin-bottom: 8px;
    }
    .cart-item-prescription {
      color: #666;
      font-size: 0.9rem;
      margin-bottom: 8px;
    }
    .cart-item-price {
      color: #183a7a;
      font-weight: bold;
    }
    
    /* Discount section */
    .discount-section {
      margin-top: 20px;
    }
    .discount-control {
      display: flex;
      gap: 10px;
    }
    .discount-input {
      flex: 1;
      padding: 12px 15px;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-family: 'Kanit', sans-serif;
      font-size: 1rem;
    }
    .apply-discount-btn {
      background: #183a7a;
      color: white;
      border: none;
      padding: 12px 20px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
      transition: background 0.3s;
    }
    .apply-discount-btn:hover {
      background: #142e5c;
    }
    .discount-applied {
      margin-top: 15px;
      padding: 12px;
      background: #d4edda;
      border-radius: 5px;
      color: #155724;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .remove-discount {
    /* Modal Responsive ปรับใหม่ให้เหมาะกับมือถือ/แท็บเล็ต */
    .address-modal {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
    /* ลบ property CSS ที่ผิดโครงสร้างออกทั้งหมด */
      padding: 16px;
    }
    .address-modal-content {
      background: #fff;
      border-radius: 16px;
      box-shadow: 0 8px 32px rgba(24,58,122,0.12);
      max-width: 400px;
      width: 100%;
      padding: 32px 24px;
      text-align: center;
      margin: 0 auto;
      position: relative;
      transition: all 0.3s;
    }
    .address-modal {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(0,0,0,0.18);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 2000;
      overflow-y: auto;
      padding: 16px;
    }
    .address-modal-content {
      background: #fff;
      border-radius: 16px;
      box-shadow: 0 8px 32px rgba(24,58,122,0.12);
      max-width: 400px;
      width: 100%;
      padding: 32px 24px;
      text-align: center;
      margin: 0 auto;
      position: relative;
      transition: all 0.3s;
    }
    .address-modal-header h2 {
      font-size: 1.35rem;
      margin-bottom: 18px;
    }
    .address-modal-content label,
    .address-modal-content input[type="radio"] {
      font-size: 1.08rem;
      margin-bottom: 8px;
    }
    .address-modal-content button {
      font-size: 1.08rem;
      padding: 10px 22px;
      border-radius: 8px;
    }
    #qrInfo img {
      width: 120px;
      height: 120px;
      border-radius: 8px;
      box-shadow: 0 2px 8px #ccc;
    }
    @media (max-width: 900px) {
      .address-modal-content {
        max-width: 98vw;
        padding: 18px 8px;
        border-radius: 12px;
      }
      .address-modal-header h2 {
        font-size: 1.12rem;
      }
      #qrInfo img {
        width: 90px !important;
        height: 90px !important;
      }
      .address-modal-content button {
        font-size: 1rem;
        padding: 9px 16px;
      }
    }
    @media (max-width: 600px) {
      .address-modal-content {
        max-width: 99vw;
        padding: 10px 2px;
        border-radius: 8px;
      }
      .address-modal {
        padding: 4px;
      }
      .address-modal-header h2 {
        font-size: 1rem;
      }
      #qrInfo img {
        width: 70px !important;
        height: 70px !important;
      }
      .address-modal-content button {
        font-size: 0.98rem;
        padding: 8px 10px;
      }
    }
      color: #721c24;
      background: none;
      border: none;
      cursor: pointer;
      font-size: 1.2rem;
    }
    
    /* Address section */
    .address-list {
      margin-bottom: 20px;
      max-height: 300px;
      overflow-y: auto;
      padding: 5px;
    }
    .address-item {
      padding: 20px;
      background: #f8f9fa;
      border-radius: 8px;
      margin-bottom: 20px;
      border: 1px solid #ddd;
      cursor: pointer;
      transition: all 0.3s;
      position: relative;
    }
    .address-item.selected {
      border-color: #183a7a;
      background-color: #e3f2fd;
      box-shadow: 0 0 0 2px #183a7a;
    }
    .address-item:hover {
      background-color: #e3f2fd;
    }
    .address-name {
      font-weight: bold;
      margin-bottom: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .address-details {
      color: #555;
      line-height: 1.6;
      margin-bottom: 10px;
    }
    .address-actions {
      display: flex;
      gap: 10px;
      margin-top: 15px;
    }
    .address-btn {
      padding: 8px 14px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.9rem;
      transition: all 0.2s;
    }
    .edit-btn {
      background: #183a7a;
      color: white;
    }
    .edit-btn:hover {
      background: #142e5c;
    }
    .delete-btn {
      background: #e74c3c;
      color: white;
    }
    .delete-btn:hover {
      background: #c0392b;
    }
    
    /* Shipping options */
    .shipping-option {
      display: flex;
      align-items: center;
      padding: 15px;
      border: 1px solid #ddd;
      border-radius: 5px;
      margin-bottom: 15px;
      cursor: pointer;
      transition: all 0.3s;
    }
    .shipping-option:hover, .shipping-option.selected {
      border-color: #183a7a;
      background-color: #f0f8ff;
    }
    .shipping-option.selected {
      box-shadow: 0 0 0 2px #183a7a;
    }
    .shipping-option input {
      margin-right: 10px;
    }
    .shipping-option label {
      flex: 1;
      cursor: pointer;
    }
    .shipping-price {
      color: #183a7a;
      font-weight: bold;
    }
    
    /* Payment options */
    .payment-option {
      display: flex;
      align-items: center;
      padding: 15px;
      border: 1px solid #ddd;
      border-radius: 5px;
      margin-bottom: 15px;
      cursor: pointer;
      transition: all 0.3s;
    }
    .payment-option:hover, .payment-option.selected {
      border-color: #183a7a;
      background-color: #f0f8ff;
    }
    .payment-option.selected {
      box-shadow: 0 0 0 2px #183a7a;
    }
    .payment-option input {
      margin-right: 10px;
    }
    .payment-option label {
      flex: 1;
      cursor: pointer;
    }
    .payment-icon {
      font-size: 24px;
      margin-right: 10px;
      color: #183a7a;
    }
    
    /* Order summary */
    .summary-row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 12px;
      padding: 8px 0;
    }
    .summary-total {
      font-weight: bold;
      font-size: 1.2rem;
      border-top: 2px solid #f0f8ff;
      padding-top: 15px;
      margin-top: 15px;
    }
    .summary-total .price {
      color: #183a7a;
    }
    .confirm-btn {
      width: 100%;
      padding: 15px;
      background: #183a7a;
      color: white;
      border: none;
      border-radius: 5px;
      font-size: 1.1rem;
      font-weight: bold;
      cursor: pointer;
      margin-top: 25px;
      transition: background 0.3s;
      box-shadow: 0 4px 10px rgba(52, 152, 219, 0.3);
    }
    .confirm-btn:hover {
      background: #2980b9;
      transform: translateY(-2px);
    }
    
    /* Address modal */
    .address-modal {
      display: none;
      position: fixed;
      z-index: 1002;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.5);
      overflow: auto;
    }
    .address-modal-content {
      background-color: #fefefe;
      margin: 3% auto;
      padding: 30px;
      border-radius: 10px;
      max-width: 700px;
      width: 90%;
      box-shadow: 0 5px 25px rgba(0,0,0,0.3);
      position: relative;
    }
    .address-modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 25px;
      padding-bottom: 15px;
      border-bottom: 2px solid #f0f8ff;
    }
    .address-modal-header h2 {
      font-size: 1.8rem;
      color: #0077b6;
    }
    .address-form {
      display: grid;
      gap: 20px;
    }
    .form-group {
      display: flex;
      flex-direction: column;
    }
    .form-group label {
      margin-bottom: 10px;
      font-weight: 500;
      font-size: 1.1rem;
    }
    .form-group input, .form-group select {
      padding: 12px 15px;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-family: 'Kanit', sans-serif;
      font-size: 1rem;
    }
    .form-group input:focus, .form-group select:focus {
      border-color: #183a7a;
      outline: none;
      box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
    }
    .form-row {
      display: flex;
      gap: 20px;
    }
    .form-row .form-group {
      flex: 1;
    }
    .form-actions {
      display: flex;
      justify-content: flex-end;
      gap: 15px;
      margin-top: 30px;
    }
    .form-actions button {
      padding: 12px 25px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
      font-size: 1rem;
      transition: all 0.3s;
    }
    .cancel-btn {
      background: #e0e0e0;
      color: #333;
    }
    .cancel-btn:hover {
      background: #d0d0d0;
    }
    .save-btn {
      background: #183a7a;
      color: white;
    }
    .save-btn:hover {
      background: #2980b9;
    }
    .close-btn {
      font-size: 32px;
      cursor: pointer;
      transition: color 0.3s;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      background: #f0f8ff;
      color: #183a7a;
    }
    .close-btn:hover {
      background: #e74c3c;
      color: white;
    }
    
    /* Thank you page */
    .thankyou-container {
      max-width: 800px;
      margin: 50px auto;
      padding: 40px;
      background: white;
      border-radius: 15px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
      text-align: center;
      display: none;
    }
    .thankyou-icon {
      font-size: 80px;
      color: #183a7a;
      margin-bottom: 30px;
    }
    .thankyou-title {
      font-size: 2.2rem;
      color: #0077b6;
      margin-bottom: 25px;
    }
    .thankyou-message {
      font-size: 1.1rem;
      color: #555;
      margin-bottom: 35px;
      line-height: 1.8;
    }
    .order-details {
      background: #f8f9fa;
      border-radius: 10px;
      padding: 25px;
      margin: 35px 0;
      text-align: left;
    }
    .order-details h3 {
      color: #0077b6;
      margin-bottom: 20px;
      font-size: 1.3rem;
      padding-bottom: 10px;
      border-bottom: 1px solid #eee;
    }
    .detail-row {
      display: flex;
      margin-bottom: 15px;
      padding: 10px 0;
    }
    .detail-label {
      font-weight: bold;
      min-width: 150px;
      color: #555;
    }
    .detail-value {
      color: #2c3e50;
    }
    .back-to-home {
      display: inline-block;
      background: #183a7a;
      color: white;
      padding: 15px 30px;
      border-radius: 50px;
      text-decoration: none;
      font-size: 1.1rem;
      font-weight: bold;
      margin-top: 25px;
      transition: all 0.3s;
      border: none;
      cursor: pointer;
      box-shadow: 0 4px 10px rgba(52, 152, 219, 0.3);
    }
    .back-to-home:hover {
      background: #2980b9;
      transform: translateY(-3px);
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }
    .back-to-home i {
      margin-right: 10px;
    }
    
    /* Footer */
    footer {
      background-color: #2c3e50;
      color: #ecf0f1;
      padding: 30px 0 15px;
    }
    .footer-container {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      gap: 20px;
      padding: 0 15px;
      max-width: 1200px;
      margin: 0 auto;
    }
    .footer-section {
      flex: 1;
      min-width: 200px;
    }
    .footer-section h3 {
      color: #fff;
      margin-bottom: 15px;
      font-size: 1.1rem;
    }
    .footer-section ul {
      list-style: none;
      padding-left: 0;
    }
    .footer-section li {
      margin-bottom: 8px;
      font-size: 0.9rem;
    }
    .footer-section a {
      color: #bdc3c7;
      text-decoration: none;
      transition: color 0.3s;
    }
    .footer-section a:hover {
      color: #2ecc71;
    }
    .contact-info li {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .social-links {
      display: flex;
      gap: 10px;
      margin-top: 10px;
    }
    .social-links a {
      font-size: 1.3rem;
      color: #2ecc71;
    }
    .payment-methods {
      display: flex;
      gap: 8px;
    }
    .payment-methods i {
      font-size: 1.7rem;
    }
    .copyright {
      text-align: center;
      margin-top: 30px;
      padding-top: 15px;
      border-top: 1px solid #34495e;
      color: #bdc3c7;
      font-size: 0.85rem;
      padding: 0 15px;
    }
    
    /* Selected badge */
    .selected-badge {
      background: #183a7a;
      color: white;
      padding: 2px 8px;
      border-radius: 10px;
      font-size: 0.8rem;
    }
    
    /* Responsive */
    /* ...existing styles... */
    @media (max-width: 800px) {
      .container { flex-direction: column; gap: 18px; }
      .checkout-left, .checkout-right { min-width: 0; }
      .input-group, .input-group.city-province-postal { flex-direction: column; gap: 12px; }
      .input-group.city-province-postal > * { width: 100%; }
    }
  </style>
</head>
<body>
  <!-- Navbar -->
  <div class="navbar">
    <div class="navbar-center" onclick="goDashboard()">
      <span><img src="../images/logo.png" style="background-color: #ffffff;height: 100px; width: auto;border-radius: 35px;box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);"></span>
    </div>
  </div>
  
  <!-- Checkout Page -->
  <div class="container" style="max-width:1200px; margin:40px auto; display:flex; gap:40px; align-items:flex-start;">
    <!-- ซ้าย: ที่อยู่สำหรับจัดส่ง -->
    <div id="cartItemsContainer" style="display:none;"></div>
    <form id="shippingForm" class="checkout-left" style="background:#fff; border-radius:12px; box-shadow:0 2px 16px rgba(0,0,0,0.07); padding:32px 32px 24px 32px; min-width:340px;">
      <h2 style="font-size:1.25rem; color:#223; font-weight:700; margin-bottom:18px;">ที่อยู่สำหรับจัดส่ง</h2>
      <div style="display:flex; flex-direction:column; margin-bottom:14px;">
        <input type="text" id="recipientName" placeholder="ชื่อผู้รับ" style="padding:10px; border-radius:7px; border:1px solid #ddd; font-size:1rem;">
        <div class="error-message hide" id="err-recipientName"></div>
      </div>
      <div style="display:flex; flex-direction:column; margin-bottom:14px;">
        <input type="text" id="address" placeholder="ที่อยู่" style="width:100%; padding:10px; border-radius:7px; border:1px solid #ddd; font-size:1rem;">
        <div class="error-message hide" id="err-address"></div>
      </div>
      <div class="input-group city-province-postal" style="margin-bottom:14px;">
        <div style="display:flex; flex-direction:column;">
          <input type="text" id="city" placeholder="เขต/อำเภอ" style="padding:10px; border-radius:7px; border:1px solid #ddd; font-size:1rem;">
          <div class="error-message hide" id="err-city"></div>
        </div>
        <div style="display:flex; flex-direction:column;">
          <select id="province" style="padding:10px; border-radius:7px; border:1px solid #ddd; font-size:1rem;">
            <option value="">เลือกจังหวัด</option>
            <option>กระบี่</option>
            <option>กรุงเทพมหานคร</option>
            <option>กาญจนบุรี</option>
            <option>กาฬสินธุ์</option>
            <option>กำแพงเพชร</option>
            <option>ขอนแก่น</option>
            <option>จันทบุรี</option>
            <option>ฉะเชิงเทรา</option>
            <option>ชลบุรี</option>
            <option>ชัยนาท</option>
            <option>ชัยภูมิ</option>
            <option>ชุมพร</option>
            <option>เชียงราย</option>
            <option>เชียงใหม่</option>
            <option>ตรัง</option>
            <option>ตราด</option>
            <option>ตาก</option>
            <option>นครนายก</option>
            <option>นครปฐม</option>
            <option>นครพนม</option>
            <option>นครราชสีมา</option>
            <option>นครศรีธรรมราช</option>
            <option>นครสวรรค์</option>
            <option>นนทบุรี</option>
            <option>นราธิวาส</option>
            <option>น่าน</option>
            <option>บึงกาฬ</option>
            <option>บุรีรัมย์</option>
            <option>ปทุมธานี</option>
            <option>ประจวบคีรีขันธ์</option>
            <option>ปราจีนบุรี</option>
            <option>ปัตตานี</option>
            <option>พระนครศรีอยุธยา</option>
            <option>พะเยา</option>
            <option>พังงา</option>
            <option>พัทลุง</option>
            <option>พิจิตร</option>
            <option>พิษณุโลก</option>
            <option>เพชรบุรี</option>
            <option>เพชรบูรณ์</option>
            <option>แพร่</option>
            <option>พังงา</option>
            <option>ภูเก็ต</option>
            <option>มหาสารคาม</option>
            <option>มุกดาหาร</option>
            <option>แม่ฮ่องสอน</option>
            <option>ยโสธร</option>
            <option>ยะลา</option>
            <option>ร้อยเอ็ด</option>
            <option>ระนอง</option>
            <option>ระยอง</option>
            <option>ราชบุรี</option>
            <option>ลพบุรี</option>
            <option>ลำปาง</option>
            <option>ลำพูน</option>
            <option>เลย</option>
            <option>ศรีสะเกษ</option>
            <option>สกลนคร</option>
            <option>สงขลา</option>
            <option>สตูล</option>
            <option>สมุทรปราการ</option>
            <option>สมุทรสงคราม</option>
            <option>สมุทรสาคร</option>
            <option>สระแก้ว</option>
            <option>สระบุรี</option>
            <option>สิงห์บุรี</option>
            <option>สุโขทัย</option>
            <option>สุพรรณบุรี</option>
            <option>สุราษฎร์ธานี</option>
            <option>สุรินทร์</option>
            <option>หนองคาย</option>
            <option>หนองบัวลำภู</option>
            <option>อ่างทอง</option>
            <option>อำนาจเจริญ</option>
            <option>อุดรธานี</option>
            <option>อุตรดิตถ์</option>
            <option>อุทัยธานี</option>
            <option>อุบลราชธานี</option>
            <option>อำนาจเจริญ</option>
            <option>อุดรธานี</option>
            <option>อุตรดิตถ์</option>
            <option>อุทัยธานี</option>
            <option>อุบลราชธานี</option>
          </select>
          <div class="error-message hide" id="err-province"></div>
        </div>
        <div style="display:flex; flex-direction:column;">
          <input type="text" id="postalCode" placeholder="รหัสไปรษณีย์" style="padding:10px; border-radius:7px; border:1px solid #ddd; font-size:1rem;">
          <div class="error-message hide" id="err-postalCode"></div>
        </div>
      </div>
      <div style="display:flex; flex-direction:column; margin-bottom:10px;">
        <input type="text" id="phone" placeholder="เบอร์โทรศัพท์" style="width:100%; padding:10px; border-radius:7px; border:1px solid #ddd; font-size:1rem;">
        <div class="error-message hide" id="err-phone"></div>
      </div>
      <div style="font-size:0.95rem; color:#444; margin-bottom:18px;">***กรุณาเป็นเบอร์โทรที่ติดต่อได้จริง เพราะต้องใช้ในระบบขนส่ง</div>
      <div style="display:flex; align-items:center; gap:12px; margin-bottom:18px;">
        <a href="buyer-cart.html" style="color:#223; font-size:1.05rem; text-decoration:none; display:flex; align-items:center; gap:6px;"><i class="fas fa-chevron-left"></i> ย้อนกลับไปตะกร้า</a>
      <button type="submit" style="background:#183a7a; color:#fff; font-size:1.08rem; font-weight:600; padding:10px 32px; border:none; border-radius:8px; cursor:pointer; margin-left:auto;">ช่องทางการชำระเงิน</button>
      </div>
      <div style="display:flex; gap:18px; margin-top:18px;">
        <a href="#" style="font-size:0.92rem; color:#888; text-decoration:underline;">นโยบายการคืนเงิน</a>
        <a href="#" style="font-size:0.92rem; color:#888; text-decoration:underline;">ข้อตกลงการใช้บริการ</a>
      </div>
    </form>
    <!-- ขวา: สรุปรายการสั่งซื้อ -->
    <div class="checkout-right" style="background:#fff; border-radius:12px; box-shadow:0 2px 16px rgba(0,0,0,0.07); padding:32px 32px 24px 32px; min-width:320px;">
      <div style="font-size:1.15rem; color:#223; font-weight:700; margin-bottom:18px; text-align:center;">สรุปรายการสั่งซื้อ</div>
      <div id="orderSummaryItems"></div>
      <div style="margin:18px 0 12px 0; display:flex; gap:8px;">
        <input id="discountInput" type="text" placeholder="รหัสคูปองส่วนลด" style="flex:1; padding:8px 12px; border-radius:7px; border:1px solid #ddd; font-size:1rem;">
        <button id="applyDiscountBtn" style="background:#183a7a; color:#fff; font-size:1rem; font-weight:600; padding:8px 18px; border:none; border-radius:7px; cursor:pointer;">ใช้สิทธิ์</button>
      </div>
      <div id="orderSummaryDetails" style="margin-top:18px;"></div>
    </div>
  </div>
  
  <!-- Thank You Page -->
  <div id="thankYouPage" class="thankyou-container">
    <div class="thankyou-icon">
      <i class="fas fa-check-circle"></i>
    </div>
    
    <h1 class="thankyou-title">ขอบคุณสำหรับการสั่งซื้อ!</h1>
    
    <p class="thankyou-message">
      การสั่งซื้อของคุณเสร็จสมบูรณ์แล้ว เราจะดำเนินการจัดส่งสินค้าให้คุณโดยเร็วที่สุด<br>
      คุณสามารถตรวจสอบสถานะการสั่งซื้อได้ในหน้าประวัติการสั่งซื้อ
    </p>
    
    <div class="order-details">
      <h3>รายละเอียดการสั่งซื้อ</h3>
      <div class="detail-row">
        <span class="detail-label">หมายเลขคำสั่งซื้อ:</span>
        <span class="detail-value" id="orderId">ORD-20230615-001</span>
      </div>
      <div class="detail-row">
        <span class="detail-label">วันที่สั่งซื้อ:</span>
        <span class="detail-value" id="orderDate">15 มิถุนายน 2023, 14:30 น.</span>
      </div>
      <div class="detail-row">
        <span class="detail-label">ยอดชำระทั้งหมด:</span>
        <span class="detail-value" id="orderTotal">1,250 บาท</span>
      </div>
      <div class="detail-row">
        <span class="detail-label">วิธีการชำระเงิน:</span>
        <span class="detail-value" id="paymentMethod">โอนเงินผ่านธนาคาร</span>
      </div>
      <div class="detail-row">
        <span class="detail-label">วิธีการจัดส่ง:</span>
        <span class="detail-value" id="shippingMethod">Kerry Express (1-2 วัน)</span>
      </div>
      <div class="detail-row">
        <span class="detail-label">สถานะ:</span>
        <span class="detail-value" style="color: #183a7a; font-weight: bold;">รอดำเนินการ</span>
      </div>
    </div>
    
    <button class="back-to-home" onclick="goDashboard()">
      <i class="fas fa-home"></i> กลับไปยังหน้าแรก
    </button>
  </div>
  
  <!-- Modal เลือกช่องทางการชำระเงิน -->
  <div id="paymentModal" class="address-modal" style="display:none;z-index:2000;align-items:center;justify-content:center;">
    <div class="address-modal-content" style="max-width:400px;padding:32px 24px;text-align:center;">
      <div class="address-modal-header"><h2>เลือกช่องทางการชำระเงิน</h2></div>
      <div style="margin:18px 0 24px 0;">
        <label><input type="radio" name="paymentType" value="cod" checked> ชำระเงินปลายทาง (COD)</label><br>
        <label><input type="radio" name="paymentType" value="bank"> โอนบัญชีธนาคาร</label><br>
        <label><input type="radio" name="paymentType" value="qr"> สแกน QR Code</label>
      </div>
      <div id="bankInfo" style="display:none;margin-bottom:16px;">
        <div>เลขบัญชี: <b>123-4-56789-0</b> (ธ.กสิกรไทย)</div>
      </div>
      <div id="qrInfo" style="display:none;margin-bottom:16px;">
        <div>สแกนจ่ายผ่าน QR Code</div>
        <img src="/images/qr-demo.jpg" alt="QR Code" style="width:120px;height:120px;border-radius:8px;box-shadow:0 2px 8px #ccc;">
      </div>
      <div id="slipUpload" style="display:none;margin-bottom:16px;">
        <label>แนบสลิปโอนเงิน:<br>
          <input type="file" id="slipInput" accept="image/*">
        </label>
        <div id="slipPreview" style="margin-top:8px;"></div>
      </div>
      <div style="margin-top:18px;display:flex;gap:12px;justify-content:center;">
        <button id="confirmPaymentBtn" class="confirm-btn" style="background:#183a7a;color:#fff;">ยืนยันการชำระเงิน</button>
        <button id="cancelPaymentBtn" class="cancel-btn" style="background:#eee;color:#333;">ยกเลิก</button>
      </div>
    </div>
  </div>

  <script>
  // --- Global Functions ---
  
  // ฟังก์ชันลบ error ใต้ input
  function clearError(id) {
    const input = document.getElementById(id);
    const err = document.getElementById('err-' + id);
    
    if (input) {
      input.classList.remove('input-error');
      input.style.borderColor = '';
    }
    
    if (err) {
      err.textContent = '';
      err.classList.add('hide');
    }
  }
  
  // ฟังก์ชันแสดงข้อความ error
  function showError(id, msg) {
    const input = document.getElementById(id);
    const err = document.getElementById('err-' + id);
    
    if (input) {
      input.classList.add('input-error');
      input.style.borderColor = '#d32f2f';
    }
    
    if (err) {
      err.textContent = msg;
      err.classList.remove('hide');
    }
  }
  
  // ฟังก์ชันแสดง notification
  function noti(msg) {
    let notiBox = document.getElementById('notiBox');
    if (!notiBox) {
      notiBox = document.createElement('div');
      notiBox.id = 'notiBox';
      notiBox.style.position = 'fixed';
      notiBox.style.top = '50%';
      notiBox.style.left = '50%';
      notiBox.style.transform = 'translate(-50%, -50%) scale(1.08)';
      notiBox.style.background = 'linear-gradient(135deg, #fffbe6 60%, #ffe0e0 100%)';
      notiBox.style.color = '#d32f2f';
      notiBox.style.padding = '22px 38px';
      notiBox.style.borderRadius = '14px';
      notiBox.style.fontSize = '1.08rem';
      notiBox.style.fontWeight = 'bold';
      notiBox.style.boxShadow = '0 8px 32px rgba(220,38,38,0.18), 0 2px 8px rgba(24,58,122,0.10)';
      notiBox.style.zIndex = '99999';
      notiBox.style.opacity = '0';
      notiBox.style.border = '3px solid #d32f2f';
      notiBox.style.textAlign = 'center';
      notiBox.style.transition = 'opacity 0.3s, transform 0.3s';
      document.body.appendChild(notiBox);
    }
    notiBox.textContent = msg;
    notiBox.style.display = 'block';
    notiBox.style.opacity = '1';
    notiBox.style.transform = 'translate(-50%, -50%) scale(1.12)';
    setTimeout(() => {
      notiBox.style.opacity = '0';
      notiBox.style.transform = 'translate(-50%, -50%) scale(1.08)';
      setTimeout(() => { notiBox.style.display = 'none'; }, 350);
    }, 2200);
  }
  
  // ฟังก์ชันไปยังหน้า dashboard
  function goDashboard() {
    window.location.href = 'buyer-dashboard.html';
  }
  
  // --- Order Summary Logic ---
  
  let orderSummary = {
    total: 0,
    qty: 0,
    lens: 0,
    shipping: 0,
    discount: 0,
    grandTotal: 0
  };
  
  function calcOrderSummary() {
    const cart = JSON.parse(localStorage.getItem('cart')) || [];
    let total = 0, qty = 0, lens = 0;
    const priceData = {
      1: { price: 700, original: 700, savings: 0, lens: 30 },
      2: { price: 1300, original: 1400, savings: 100, lens: 60 },
      4: { price: 2400, original: 2800, savings: 400, lens: 120 }
    };
    cart.forEach(item => {
      const pd = priceData[item.quantity] || priceData[1];
      total += pd.price;
      qty += item.quantity;
      lens += pd.lens;
    });
    
    // Shipping: ฟรีถ้า total >= 1000, 50 บาทถ้าต่ำกว่า
    let shipping = total >= 1000 ? 0 : 50;
    
    // Discount: ใช้ window.currentDiscount/window.discountType
    let discount = 0;
    if (window.discountType === 'fixed') {
      discount = window.currentDiscount || 0;
    } else if (window.discountType === 'percentage') {
      discount = Math.floor(total * (window.currentDiscount || 0) / 100);
    }
    
    let grandTotal = total + shipping - discount;
    if (grandTotal < 0) grandTotal = 0;
    
    orderSummary = { total, qty, lens, shipping, discount, grandTotal };
  }
  
  function renderOrderSummary() {
    const cart = JSON.parse(localStorage.getItem('cart')) || [];
    const orderSummaryItems = document.getElementById('orderSummaryItems');
    const orderSummaryDetails = document.getElementById('orderSummaryDetails');
    
    if (!orderSummaryItems || !orderSummaryDetails) return;
    
    let html = '';
    calcOrderSummary();
    
    if (cart.length === 0) {
      orderSummaryItems.innerHTML = '<div style="text-align:center; color:#888; font-size:1.1rem; padding:32px 0;">ไม่มีสินค้าในตะกร้า</div>';
      orderSummaryDetails.innerHTML = '';
      return;
    }
    
    // Render cart items
    cart.forEach(item => {
      let unitPrice = 700;
      let totalPrice = 0;
      let showPrice = 700;
      let priceText = '';
      
      if (item.quantity === 2) {
        unitPrice = 650;
        totalPrice = 1300;
        showPrice = 1300;
        priceText = `${unitPrice.toLocaleString(undefined, {minimumFractionDigits:2, maximumFractionDigits:2})} x 2 บาท`;
      } else if (item.quantity === 4) {
        unitPrice = 600;
        totalPrice = 2400;
        showPrice = 2400;
        priceText = `${unitPrice.toLocaleString(undefined, {minimumFractionDigits:2, maximumFractionDigits:2})} x 2 บาท`;
      } else {
        totalPrice = 700 * item.quantity;
        showPrice = totalPrice;
        priceText = `${unitPrice.toLocaleString()} บาท`;
      }
      
      // Fix image path
      let imgPath = item.image;
      if (imgPath && !imgPath.startsWith('../')) {
        imgPath = '../images/' + imgPath.replace(/^images\//, '').replace(/^\/images\//, '');
      }
      
      // Render based on eye prescription
      if (item.rightEye && item.leftEye && item.rightEye !== item.leftEye) {
        // Right eye
        html += `
          <div style="display:flex; align-items:center; gap:12px; margin-bottom:10px;">
            <img src="${imgPath}" alt="${item.name}" style="width:48px; height:48px; border-radius:8px; background:#fff; box-shadow:0 1px 4px rgba(0,0,0,0.09); object-fit:contain;">
            <div style="flex:1;">
              <div style="font-size:1.02rem; font-weight:600; color:#183a7a;">ตาขวา</div>
              <div style="font-size:0.97rem; color:#333;">ค่าสายตา: <span style="color:#888;">${item.rightEye}</span></div>
            </div>
            <div style="font-size:1.08rem; color:#183a7a; font-weight:700; min-width:80px; text-align:right;">${item.quantity === 4 ? '600.00 x 2 บาท' : unitPrice.toLocaleString(undefined, {minimumFractionDigits:2, maximumFractionDigits:2}) + ' บาท'}</div>
          </div>
        `;
        
        // Left eye
        html += `
          <div style="display:flex; align-items:center; gap:12px; margin-bottom:10px;">
            <img src="${imgPath}" alt="${item.name}" style="width:48px; height:48px; border-radius:8px; background:#fff; box-shadow:0 1px 4px rgba(0,0,0,0.09); object-fit:contain;">
            <div style="flex:1;">
              <div style="font-size:1.02rem; font-weight:600; color:#183a7a;">ตาซ้าย</div>
              <div style="font-size:0.97rem; color:#333;">ค่าสายตา: <span style="color:#888;">${item.leftEye}</span></div>
            </div>
            <div style="font-size:1.08rem; color:#183a7a; font-weight:700; min-width:80px; text-align:right;">${item.quantity === 4 ? '600.00 x 2 บาท' : unitPrice.toLocaleString(undefined, {minimumFractionDigits:2, maximumFractionDigits:2}) + ' บาท'}</div>
          </div>
        `;
      } else {
        // Same prescription or single eye
        html += `
          <div style="display:flex; align-items:center; gap:12px; margin-bottom:10px;">
            <img src="${imgPath}" alt="${item.name}" style="width:48px; height:48px; border-radius:8px; background:#fff; box-shadow:0 1px 4px rgba(0,0,0,0.09); object-fit:contain;">
            <div style="flex:1;">
              <div style="font-size:1.02rem; font-weight:600; color:#183a7a;">${item.name || ''}</div>
              <div style="font-size:0.97rem; color:#333;">ตาขวา: <span style="color:#888;">${item.rightEye || '-'}</span> | ตาซ้าย: <span style="color:#888;">${item.leftEye || '-'}</span></div>
            </div>
            <div style="font-size:1.08rem; color:#183a7a; font-weight:700; min-width:80px; text-align:right;">${item.quantity === 4 ? '600.00 x 2 บาท' : showPrice.toLocaleString() + ' บาท'}</div>
          </div>
        `;
      }
    });
    
    orderSummaryItems.innerHTML = html;
    
    // Render order summary
    orderSummaryDetails.innerHTML = `
      <div style="display:flex; justify-content:space-between; margin-bottom:10px; font-size:1.01rem;">
        <span>จำนวน</span>
        <span>${orderSummary.qty} ชุด (${orderSummary.lens} เลนส์)</span>
      </div>
      <div style="display:flex; justify-content:space-between; margin-bottom:10px; font-size:1.01rem;">
        <span>ยอดรวมสินค้า</span>
        <span>${orderSummary.total.toLocaleString()} บาท</span>
      </div>
      <div style="display:flex; justify-content:space-between; margin-bottom:10px; font-size:1.01rem;">
        <span>ค่าจัดส่ง</span>
        <span id="orderSummaryShipping">${orderSummary.shipping.toLocaleString()} บาท</span>
      </div>
      <div style="display:flex; justify-content:space-between; margin-bottom:10px; font-size:1.01rem;">
        <span>ส่วนลด</span>
        <span id="orderSummaryDiscount">${orderSummary.discount.toLocaleString()} บาท</span>
      </div>
      <div style="display:flex; justify-content:space-between; font-size:1.13rem; font-weight:700; border-top:1px solid #eee; padding-top:10px; margin-top:10px;">
        <span>รวม</span>
        <span id="orderSummaryTotal">${orderSummary.grandTotal.toLocaleString()} บาท</span>
      </div>
    `;
  }
  
  // --- Event Handlers ---
  
  // Discount input logic
  document.getElementById('applyDiscountBtn').onclick = function() {
    const code = (document.getElementById('discountInput').value || '').trim().toUpperCase();
    if (!code) { 
      noti('กรุณากรอกรหัสคูปองส่วนลด'); 
      return; 
    }
    
    if (code === 'SAVE100') {
      window.currentDiscount = 100; 
      window.discountType = 'fixed';
    } else if (code === 'SAVE10%') {
      window.currentDiscount = 10; 
      window.discountType = 'percentage';
    } else {
      noti('รหัสคูปองไม่ถูกต้องหรือหมดอายุ'); 
      return;
    }
    
    renderOrderSummary();
  };
  
  document.getElementById('discountInput').oninput = function() {
    if (!this.value) { 
      window.currentDiscount = 0; 
      window.discountType = ''; 
      renderOrderSummary(); 
    }
  };
  
  // Form submission
  const shippingForm = document.getElementById('shippingForm');
  shippingForm.onsubmit = function(e) {
    e.preventDefault();
    
    if (orderSummary.qty === 0) { 
      noti('ไม่มีสินค้าในตะกร้า'); 
      return; 
    }
    
    // Validate each field
    let valid = true;
    
    // Required fields
    const requiredFields = [
      { id: 'recipientName', msg: 'กรุณากรอกชื่อผู้รับ' },
      { id: 'address', msg: 'กรุณากรอกที่อยู่' },
      { id: 'city', msg: 'กรุณากรอกเขต/อำเภอ' },
      { id: 'province', msg: 'กรุณาเลือกจังหวัด' },
      { id: 'postalCode', msg: 'กรุณากรอกรหัสไปรษณีย์' },
      { id: 'phone', msg: 'กรุณากรอกเบอร์โทรศัพท์' }
    ];
    
    requiredFields.forEach(f => {
      const input = document.getElementById(f.id);
      if (!input.value.trim() || (f.id === 'province' && input.value === '')) {
        showError(f.id, f.msg);
        if (valid) input.focus();
        valid = false;
      } else {
        clearError(f.id);
      }
    });
    
    if (!valid) return;
    
    // เปิด modal เลือกช่องทางการชำระเงิน
    document.getElementById('paymentModal').style.display = 'flex';
  };
  
  // Clear error on input
  ['recipientName','address','city','province','postalCode','phone'].forEach(id => {
    const el = document.getElementById(id);
    if (el) {
      el.addEventListener('input', function() {
        if (this.value.trim() || (id === 'province' && this.value !== '')) {
          clearError(id);
        }
      });
      
      // สำหรับ dropdown
      if (id === 'province') {
        el.addEventListener('change', function() {
          if (this.value !== '') clearError(id);
        });
      }
    }
  });
  
  // Modal logic
  const paymentModal = document.getElementById('paymentModal');
  const confirmPaymentBtn = document.getElementById('confirmPaymentBtn');
  const cancelPaymentBtn = document.getElementById('cancelPaymentBtn');
  const slipInput = document.getElementById('slipInput');
  const slipPreview = document.getElementById('slipPreview');
  
  let selectedPayment = 'cod';
  let slipFile = null;
  
  // เปลี่ยนช่องทางการชำระเงิน
  document.querySelectorAll('input[name="paymentType"]').forEach(radio => {
    if (radio) {
      radio.onchange = function() {
        selectedPayment = this.value;
        const bankInfo = document.getElementById('bankInfo');
        const qrInfo = document.getElementById('qrInfo');
        const slipUpload = document.getElementById('slipUpload');
        
        if (bankInfo) bankInfo.style.display = (this.value === 'bank') ? 'block' : 'none';
        if (qrInfo) qrInfo.style.display = (this.value === 'qr') ? 'block' : 'none';
        if (slipUpload) slipUpload.style.display = (this.value === 'bank' || this.value === 'qr') ? 'block' : 'none';
      };
    }
  });
  
  // อัปโหลดสลิป
  if (slipInput) {
    slipInput.onchange = function() {
      slipFile = this.files[0];
      if (slipFile) {
        const reader = new FileReader();
        reader.onload = function(e) {
          if (slipPreview) {
            slipPreview.innerHTML = `<img src="${e.target.result}" style="max-width:120px;border-radius:8px;box-shadow:0 2px 8px #ccc;">`;
          }
        };
        reader.readAsDataURL(slipFile);
      } else {
        if (slipPreview) slipPreview.innerHTML = '';
      }
    };
  }
  
  // ยกเลิก modal
  if (cancelPaymentBtn) {
    cancelPaymentBtn.onclick = function() {
      if (paymentModal) paymentModal.style.display = 'none';
      if (slipInput) slipInput.value = '';
      if (slipPreview) slipPreview.innerHTML = '';
    };
  }
  
  // ยืนยันการชำระเงิน
  if (confirmPaymentBtn) {
    confirmPaymentBtn.onclick = function() {
      // ถ้าเลือกโอน/QR ต้องแนบสลิป
      if ((selectedPayment === 'bank' || selectedPayment === 'qr') && !slipFile) {
        noti('กรุณาแนบสลิปโอนเงิน');
        return;
      }
      
      // สร้างข้อมูล order
      const cartItems = JSON.parse(localStorage.getItem('cart')) || [];
      const addrFields = ['recipientName','address','city','province','postalCode','phone'];
      const addr = {};
      const addrInputs = shippingForm ? shippingForm.querySelectorAll('input,select') : [];
      
      addrFields.forEach((f,i) => {
        const el = addrInputs[i];
        if (el) addr[f] = el.value;
      });
      
      const orderPayload = {
        items: cartItems,
        address: addr,
        subtotal: orderSummary.total,
        shippingFee: orderSummary.shipping,
        discount: orderSummary.discount,
        total: orderSummary.grandTotal,
        paymentType: selectedPayment
      };
      
      // ถ้ามีสลิปแนบ ให้ส่งไปด้วย (base64)
      if (slipFile) {
        const reader = new FileReader();
        reader.onload = function(e) {
          orderPayload.slipImage = e.target.result;
          submitOrder(orderPayload);
        };
        reader.readAsDataURL(slipFile);
      } else {
        submitOrder(orderPayload);
      }
      
      if (paymentModal) paymentModal.style.display = 'none';
      if (slipInput) slipInput.value = '';
      if (slipPreview) slipPreview.innerHTML = '';
    };
  }
  
  function submitOrder(orderPayload) {
    // ในที่นี้เราจะจำลองการส่งข้อมูลเท่านั้น
    console.log('Order submitted:', orderPayload);
    
    // ลบข้อมูลในตะกร้า
    localStorage.removeItem('cart');
    
    // แสดงหน้า thank you
    document.querySelector('.container').style.display = 'none';
    document.getElementById('thankYouPage').style.display = 'block';
    document.getElementById('orderId').textContent = 'ORD-' + Date.now();
    document.getElementById('orderDate').textContent = new Date().toLocaleString();
    document.getElementById('orderTotal').textContent = orderSummary.grandTotal.toLocaleString() + ' บาท';
    
    let payText = '';
    if (orderPayload.paymentType === 'cod') payText = 'ชำระเงินปลายทาง';
    else if (orderPayload.paymentType === 'bank') payText = 'โอนบัญชีธนาคาร';
    else if (orderPayload.paymentType === 'qr') payText = 'สแกน QR Code';
    
    document.getElementById('paymentMethod').textContent = payText;
    document.getElementById('shippingMethod').textContent = 'จัดส่งปกติ';
  }
  
  // Initialize
  document.addEventListener('DOMContentLoaded', function() {
    renderOrderSummary();
    
    // ตั้งค่าข้อมูลเริ่มต้นสำหรับส่วนลด
    window.currentDiscount = 0;
    window.discountType = '';
    
    // ตั้งค่าการแสดงผล error message เริ่มต้น
    ['recipientName','address','city','province','postalCode','phone'].forEach(id => {
      clearError(id);
    });
  });
  
  window.addEventListener('storage', function(e) { 
    if (e.key === 'cart') renderOrderSummary(); 
  });
  </script>
</body>
</html>
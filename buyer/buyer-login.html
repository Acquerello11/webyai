<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Alice Moist Daily - สมัครสมาชิก/ล็อกอิน</title>
  <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Kanit', sans-serif;
    }
    
    body {
      min-height: 100vh;
      background: linear-gradient(120deg, #e0eafc 0%, #cfdef3 100%);
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 24px;
      position: relative;
      overflow-x: hidden;
    }
    
    .login-bg {
      width: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      z-index: 1;
    }
    
    .login-card {
      background: rgba(255,255,255,0.85);
      border-radius: 32px;
      box-shadow: 0 12px 40px 0 rgba(52,152,219,0.18), 0 2px 8px rgba(44,62,80,0.10);
      max-width: 420px;
      width: 100%;
      padding: 48px 36px 36px 36px;
      display: flex;
      flex-direction: column;
      align-items: center;
      position: relative;
      backdrop-filter: blur(8px) saturate(120%);
      border: 1.5px solid rgba(52,152,219,0.10);
      transition: box-shadow 0.3s, background 0.3s;
    }
    .login-card:hover {
      box-shadow: 0 18px 60px 0 rgba(52,152,219,0.22), 0 4px 16px rgba(44,62,80,0.13);
      background: rgba(255,255,255,0.93);
    }
    
    .login-logo img {
      width: 100px;
      height: 100px;
      border-radius: 50%;
      box-shadow: 0 4px 16px rgba(52,152,219,0.13);
      margin-bottom: 22px;
      border: 4px solid #e3f2fd;
      background: #fff;
      object-fit: cover;
    }
    
    .login-title {
      font-size: 2.2rem;
      font-weight: 700;
      color: #3498db;
      margin-bottom: 22px;
      text-align: center;
      letter-spacing: 1.2px;
      text-shadow: 0 2px 8px rgba(52,152,219,0.10);
    }
    
    .login-tabs {
      display: flex;
      width: 100%;
      margin-bottom: 28px;
      border-bottom: 2.5px solid #e3eafc;
      background: transparent;
      border-radius: 12px 12px 0 0;
      overflow: hidden;
    }
    .login-tab {
      flex: 1;
      padding: 14px 0 12px 0;
      background: none;
      border: none;
      font-size: 1.13rem;
      font-weight: 600;
      color: #7b8fa6;
      cursor: pointer;
      transition: color 0.2s, background 0.2s;
      outline: none;
      position: relative;
      border-radius: 12px 12px 0 0;
      letter-spacing: 0.5px;
    }
    .login-tab.active {
      color: #3498db;
      background: linear-gradient(90deg, #e3f2fd 60%, #f0f8ff 100%);
      box-shadow: 0 2px 8px rgba(52,152,219,0.07);
    }
    .login-tab.active::after {
      content: "";
      position: absolute;
      left: 18%;
      bottom: -2.5px;
      width: 64%;
      height: 3.5px;
      background: #3498db;
      border-radius: 3px;
      box-shadow: 0 2px 8px rgba(52,152,219,0.10);
    }
    
    .login-forms {
      width: 100%;
    }
    
    .login-form {
      display: none;
      flex-direction: column;
      gap: 0;
      animation: fadeIn 0.5s ease;
    }
    
    .login-form.active {
      display: flex;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .form-title {
      font-size: 1.3rem;
      font-weight: 500;
      color: #2c3e50;
      margin-bottom: 18px;
      text-align: left;
    }
    
    .form-group {
      margin-bottom: 18px;
      position: relative;
    }
    
    .form-group label {
      display: block;
      margin-bottom: 7px;
      font-weight: 500;
      color: #2c3e50;
    }
    
    .form-control {
      width: 100%;
      padding: 15px 18px;
      border: 2px solid #e3eafc;
      border-radius: 12px;
      font-size: 1.05rem;
      background: rgba(255,255,255,0.95);
      transition: border 0.2s, box-shadow 0.2s;
      color: #2c3e50;
      box-shadow: 0 2px 8px rgba(52,152,219,0.04);
    }
    .form-control:focus {
      border-color: #3498db;
      outline: none;
      box-shadow: 0 0 0 3px rgba(52,152,219,0.13);
      background: #fafdff;
    }
    
    .password-toggle {
      position: absolute;
      right: 18px;
      top: 38px;
      cursor: pointer;
      color: #95a5a6;
      z-index: 2;
    }
    
    .btn {
      width: 100%;
      padding: 12px;
      background: #fff;
      color: #3498db;
      border: 1.5px solid #3498db;
      border-radius: 8px;
      font-size: 1.08rem;
      font-weight: 500;
      cursor: pointer;
      transition: background 0.18s, color 0.18s, border 0.18s, box-shadow 0.18s;
      margin-top: 10px;
      box-shadow: none;
      letter-spacing: 0.2px;
    }
    .btn:hover, .btn:focus {
      background: #3498db;
      color: #fff;
      border-color: #3498db;
      box-shadow: 0 2px 8px rgba(52,152,219,0.10);
      outline: none;
      transform: none;
    }
    
    .form-footer {
      text-align: center;
      margin-top: 18px;
      color: #7f8c8d;
      font-size: 0.98rem;
    }
    
    .form-footer a {
      color: #3498db;
      text-decoration: none;
      font-weight: 500;
    }
    
    .form-footer a:hover {
      text-decoration: underline;
    }
    
    .error-message {
      color: #e74c3c;
      font-size: 0.92rem;
      margin-top: 4px;
      display: none;
    }
    
    .input-error {
      border-color: #e74c3c !important;
    }
    
    .verification-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      z-index: 1000;
      justify-content: center;
      align-items: center;
    }
    
    .verification-modal.show {
      display: flex;
    }
    
    .verification-container {
      background: white;
      border-radius: 20px;
      padding: 40px;
      max-width: 500px;
      width: 90%;
      text-align: center;
      animation: modalFadeIn 0.5s ease;
      box-shadow: 0 15px 30px rgba(0, 0, 0, 0.2);
    }
    
    @keyframes modalFadeIn {
      from { opacity: 0; transform: translateY(-30px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .verification-icon {
      font-size: 4rem;
      color: #3498db;
      margin-bottom: 20px;
    }
    
    .verification-title {
      font-size: 1.8rem;
      margin-bottom: 15px;
      color: #2c3e50;
    }
    
    .verification-text {
      color: #7f8c8d;
      margin-bottom: 30px;
      line-height: 1.6;
    }
    
    .verification-code {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-bottom: 30px;
    }
    
    .code-input {
      width: 50px;
      height: 60px;
      border: 2px solid #ecf0f1;
      border-radius: 10px;
      text-align: center;
      font-size: 1.5rem;
      font-weight: bold;
    }
    
    .code-input:focus {
      border-color: #3498db;
      outline: none;
    }
    
    .resend-link {
      color: #3498db;
      cursor: pointer;
      margin-top: 20px;
      display: inline-block;
    }
    
    .notification {
      position: fixed;
      top: 30px;
      right: 30px;
      z-index: 9999;
      background: #fff;
      color: #333;
      border-radius: 8px;
      box-shadow: 0 4px 16px rgba(0,0,0,0.15);
      padding: 18px 28px;
      min-width: 220px;
      font-size: 1rem;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s, transform 0.3s;
      transform: translateY(-20px);
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .notification.success {
      border-left: 6px solid #2ecc71;
    }
    
    .notification.error {
      border-left: 6px solid #e74c3c;
    }
    
    .notification.show {
      opacity: 1;
      pointer-events: auto;
      transform: translateY(0);
    }
    
    .notification.hide {
      opacity: 0;
      pointer-events: none;
      transform: translateY(-20px);
    }
    
    .notification-content i {
      font-size: 1.3em;
      margin-right: 8px;
    }
    
    .input-icon .password-toggle {
      right: 15px;
      left: auto;
      top: 50%;
      transform: translateY(-50%);
      position: absolute;
      z-index: 2;
    }
    
    #registerForm {
      border: 1.5px solid #e0e0e0;
      border-radius: 18px;
      box-shadow: 0 4px 18px rgba(52,152,219,0.08), 0 1.5px 6px rgba(44,62,80,0.04);
      background: #fff;
      padding: 35px 30px 30px 30px;
      margin-top: 10px;
    }
    
    .quick-nav-btn {
      background: #fff;
      border: 1.5px solid #b0beca;
      color: #3498db;
      font-size: 1.05rem;
      font-weight: 500;
      border-radius: 8px;
      padding: 10px 18px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      box-shadow: none;
      transition: background 0.15s, color 0.15s, border 0.15s;
      outline: none;
      font-family: 'Kanit', sans-serif;
      margin-bottom: 6px;
      letter-spacing: 0.2px;
    }
    .quick-nav-btn i {
      font-size: 1.2em;
      margin-right: 7px;
      filter: none;
    }
    .quick-nav-btn.main-btn {
      background: #3498db;
      color: #fff;
      border-color: #3498db;
      font-weight: 600;
      box-shadow: 0 2px 8px rgba(52,152,219,0.10);
    }
    .quick-nav-btn.main-btn:hover, .quick-nav-btn.main-btn:focus {
      background: #217dbb;
      color: #fff;
      border-color: #217dbb;
    }
    .quick-nav-btn.shopping-btn {
      background: #fff;
      color: #3498db;
      border: 1.5px solid #3498db;
      font-weight: 600;
    }
    .quick-nav-btn.shopping-btn:hover, .quick-nav-btn.shopping-btn:focus {
      background: #3498db;
      color: #fff;
      border-color: #3498db;
    }
    .quick-nav-btn:hover, .quick-nav-btn:focus {
      background: #3498db;
      color: #fff;
      border-color: #3498db;
    }
    
    .nav-quick-btns {
      position: absolute;
      top: 18px;
      left: 0;
      right: 0;
      z-index: 100;
      display: flex;
      justify-content: center;
      gap: 28px;
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 10px;
      background: transparent;
      pointer-events: none;
    }
    .nav-quick-btns > * {
      pointer-events: auto;
    }
    
    @media (max-width: 768px) {
      .login-card {
        max-width: 98vw;
        padding: 32px 8vw 28px 8vw;
      }
      .nav-quick-btns {
        top: 8px;
        gap: 12px;
        padding: 0 2vw;
      }
      .quick-nav-btn {
        font-size: 0.95rem;
        padding: 8px 8px;
        gap: 7px;
        min-width: 0;
      }
      .quick-nav-btn i {
        font-size: 1.1em;
        margin-right: 5px;
      }
    }
    @media (max-width: 576px) {
      .login-card {
        max-width: 100vw;
        padding: 18px 2vw 16px 2vw;
      }
      .nav-quick-btns {
        top: 4px;
        gap: 5px;
        padding: 0 1vw;
      }
      .quick-nav-btn {
        font-size: 0.85rem;
        padding: 6px 2px;
        gap: 3px;
        min-width: 0;
      }
      .quick-nav-btn i {
        font-size: 0.95em;
        margin-right: 2px;
      }
    }
  </style>
</head>
<body>
  <div class="login-bg">
    <div class="login-card">
      <div class="nav-quick-btns">
        <button class="quick-nav-btn main-btn" onclick="window.location.href='../index.html'">
          <i class="fas fa-home"></i> <span>หน้าหลัก</span>
        </button>
        <button class="quick-nav-btn shopping-btn" onclick="window.location.href='buyer-dashboard.html'">
          <i class="fas fa-shopping-cart"></i> <span>ช้อปปิ้ง</span>
        </button>
      
      </div>
      
      <div class="login-logo">
        <img src="logo.png" alt="Alice Moist Daily" />
      </div>
      <h1 class="login-title">Alice Moist Daily</h1>
      
      <div class="login-tabs">
        <button class="login-tab active" data-tab="login">เข้าสู่ระบบ</button>
        <button class="login-tab" data-tab="register">สมัครสมาชิก</button>
      </div>
      
      <div class="login-forms">
        <!-- Login Form -->
        <form id="loginForm" class="login-form active">
          <h2 class="form-title">เข้าสู่ระบบ</h2>
          <div class="form-group">
            <label for="loginUsername">อีเมลหรือเบอร์โทรศัพท์</label>
            <input type="text" id="loginUsername" class="form-control" placeholder="อีเมลหรือเบอร์โทรศัพท์">
            <div class="error-message" id="loginUsernameError"></div>
          </div>
          <div class="form-group">
            <label for="loginPassword">รหัสผ่าน</label>
            <div class="input-icon">
              <input type="password" id="loginPassword" class="form-control" placeholder="รหัสผ่าน">
              <span class="password-toggle"><i class="fas fa-eye"></i></span>
            </div>
            <div class="error-message" id="loginPasswordError"></div>
          </div>
          <button type="button" class="btn" id="loginBtn">เข้าสู่ระบบ</button>
          <div class="form-footer">
            ลืมรหัสผ่าน? <a href="#" id="forgotPassword">รีเซ็ตรหัสผ่าน</a>
          </div>
        </form>
        
        <!-- Register Form -->
        <form id="registerForm" class="login-form">
          <h2 class="form-title">สมัครสมาชิก</h2>
          <div class="form-group">
            <label for="fullName">ชื่อ-นามสกุล</label>
            <input type="text" id="fullName" class="form-control" placeholder="ชื่อ-นามสกุล">
            <div class="error-message" id="fullNameError"></div>
          </div>
          <div class="form-group">
            <label for="phone">เบอร์โทรศัพท์</label>
            <input type="tel" id="phone" class="form-control" placeholder="เบอร์โทรศัพท์">
            <div class="error-message" id="phoneError"></div>
          </div>
          <div class="form-group">
            <label for="email">อีเมล</label>
            <input type="email" id="email" class="form-control" placeholder="อีเมล">
            <div class="error-message" id="emailError"></div>
          </div>
          <div class="form-group">
            <label for="password">รหัสผ่าน</label>
            <div class="input-icon">
              <input type="password" id="password" class="form-control" placeholder="รหัสผ่าน (6 ตัวขึ้นไป)">
              <span class="password-toggle"><i class="fas fa-eye"></i></span>
            </div>
            <div class="error-message" id="passwordError"></div>
          </div>
          <div class="form-group">
            <label for="confirmPassword">ยืนยันรหัสผ่าน</label>
            <div class="input-icon">
              <input type="password" id="confirmPassword" class="form-control" placeholder="ยืนยันรหัสผ่าน">
              <span class="password-toggle"><i class="fas fa-eye"></i></span>
            </div>
            <div class="error-message" id="confirmPasswordError"></div>
          </div>
          <button type="button" class="btn" id="registerBtn">สมัครสมาชิก</button>
        </form>
      </div>
    </div>
  </div>
  
  <!-- Email Verification Modal -->
  <div class="verification-modal" id="verificationModal">
    <div class="verification-container" style="position:relative;">
      <button id="closeVerificationModal" style="position:absolute;top:18px;right:18px;background:transparent;border:none;font-size:1.6rem;color:#3498db;cursor:pointer;z-index:10;" aria-label="ปิด">&times;</button>
      <div class="verification-icon">
        <i class="fas fa-envelope-open-text"></i>
      </div>
      <h2 class="verification-title">ยืนยันอีเมลของคุณ</h2>
      <p class="verification-text">เราได้ส่งรหัสยืนยันไปยังอีเมล <span id="userEmail">user@example.com</span> กรุณากรอกรหัสยืนยัน 6 หลักที่ได้รับในอีเมลของคุณ</p>
      <div class="verification-code">
        <input type="text" class="code-input" maxlength="1">
        <input type="text" class="code-input" maxlength="1">
        <input type="text" class="code-input" maxlength="1">
        <input type="text" class="code-input" maxlength="1">
        <input type="text" class="code-input" maxlength="1">
        <input type="text" class="code-input" maxlength="1">
      </div>
      <button class="btn" id="verifyBtn">ยืนยัน</button>
      <div class="form-footer">
        ไม่ได้รับอีเมล? <span class="resend-link" id="resendLink">ส่งอีกครั้ง</span>
      </div>
    </div>
  </div>
  
  <!-- Reset Password Modal -->
  <div class="verification-modal" id="resetPasswordModal">
    <div class="verification-container">
      <div class="verification-icon">
        <i class="fas fa-key"></i>
      </div>
      <h2 class="verification-title">รีเซ็ตรหัสผ่าน</h2>
      <p class="verification-text">กรอกอีเมล รหัสผ่านใหม่ และยืนยันรหัสผ่าน</p>
      <div class="form-group">
        <input type="email" id="resetEmail" class="form-control" placeholder="อีเมล" required>
      </div>
      <div class="form-group">
        <input type="password" id="resetNewPassword" class="form-control" placeholder="รหัสผ่านใหม่ (6 ตัวขึ้นไป)" required>
      </div>
      <div class="form-group">
        <input type="password" id="resetConfirmPassword" class="form-control" placeholder="ยืนยันรหัสผ่านใหม่" required>
      </div>
      <button class="btn" id="resetPasswordBtn">รีเซ็ตรหัสผ่าน</button>
      <div class="form-footer">
        <a href="#" id="closeResetPasswordModal">ยกเลิก</a>
      </div>
    </div>
  </div>
  
  <script>
    // ==================== DOM Elements ====================
    const loginTab = document.querySelector('[data-tab="login"]');
    const registerTab = document.querySelector('[data-tab="register"]');
    const loginForm = document.getElementById('loginForm');
    const registerForm = document.getElementById('registerForm');
    const verificationModal = document.getElementById('verificationModal');
    const resetPasswordModal = document.getElementById('resetPasswordModal');
    const userEmailSpan = document.getElementById('userEmail');
    const resendLink = document.getElementById('resendLink');
    const verifyBtn = document.getElementById('verifyBtn');
    const codeInputs = document.querySelectorAll('.code-input');
    const loginBtn = document.getElementById('loginBtn');
    const registerBtn = document.getElementById('registerBtn');
    const forgotPasswordLink = document.getElementById('forgotPassword');
    const resetPasswordBtn = document.getElementById('resetPasswordBtn');
    const closeResetPasswordModal = document.getElementById('closeResetPasswordModal');
    const closeVerificationModal = document.getElementById('closeVerificationModal');
    
    // ==================== Constants ====================
    const API_BASE_URL = 'http://localhost:3000'; // เปลี่ยนเป็น IP ของเครื่องที่รัน Node.js
    
    // ==================== Utility Functions ====================
    function showError(fieldId, message) {
      const errorElement = document.getElementById(`${fieldId}Error`);
      const inputElement = document.getElementById(fieldId);
      
      if (errorElement && inputElement) {
        errorElement.textContent = message;
        errorElement.style.display = 'block';
        inputElement.classList.add('input-error');
      }
    }
    
    function hideError(fieldId) {
      const errorElement = document.getElementById(`${fieldId}Error`);
      const inputElement = document.getElementById(fieldId);
      
      if (errorElement && inputElement) {
        errorElement.style.display = 'none';
        inputElement.classList.remove('input-error');
      }
    }
    
    function showNotification(message, type) {
      // Remove existing notifications
      const existing = document.querySelector('.notification');
      if (existing) existing.remove();
      
      const notification = document.createElement('div');
      notification.className = `notification ${type}`;
      notification.innerHTML = `
        <div class="notification-content">
          <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-circle'}"></i>
          ${message}
        </div>
      `;
      
      document.body.appendChild(notification);
      notification.classList.add('show');
      
      setTimeout(() => {
        notification.classList.remove('show');
        notification.classList.add('hide');
        setTimeout(() => notification.remove(), 300);
      }, 3000);
    }
    
    // ==================== Form Switching ====================
    function switchToLogin() {
      loginTab.classList.add('active');
      registerTab.classList.remove('active');
      loginForm.classList.add('active');
      registerForm.classList.remove('active');
    }
    
    function switchToRegister() {
      registerTab.classList.add('active');
      loginTab.classList.remove('active');
      registerForm.classList.add('active');
      loginForm.classList.remove('active');
    }
    
    loginTab.addEventListener('click', switchToLogin);
    registerTab.addEventListener('click', switchToRegister);
    
    // ==================== Password Toggle ====================
    function setupPasswordToggles() {
      document.querySelectorAll('.password-toggle').forEach(toggle => {
        toggle.addEventListener('click', function() {
          const input = this.closest('.input-icon').querySelector('input');
          const type = input.getAttribute('type') === 'password' ? 'text' : 'password';
          const icon = this.querySelector('i');
          
          input.setAttribute('type', type);
          icon.classList.toggle('fa-eye');
          icon.classList.toggle('fa-eye-slash');
        });
      });
    }
    
    // ==================== Email Verification ====================
    function showVerificationModal(email) {
      userEmailSpan.textContent = email;
      verificationModal.classList.add('show');
      
      // Clear code inputs
      codeInputs.forEach(input => input.value = '');
      
      // Focus first input
      codeInputs[0].focus();
    }
    
    async function verifyEmail() {
      let code = '';
      codeInputs.forEach(input => { code += input.value; });
      
      if (code.length === 6 && /^\d{6}$/.test(code)) {
        const email = userEmailSpan.textContent;
        try {
          // Simulate API call
          await new Promise(resolve => setTimeout(resolve, 1000));
          // Show success notification
          showNotification('ยืนยันอีเมลสำเร็จ! คุณสามารถเข้าสู่ระบบได้แล้ว', 'success');
          // Save user data (simulated)
          localStorage.setItem('buyer_email', email);
          // ไม่ปิด modal และไม่ switchToLogin() อัตโนมัติ ให้ user ปิด modal เอง
        } catch (e) {
          showNotification('เกิดข้อผิดพลาดในการยืนยันอีเมล', 'error');
        }
      } else {
        showNotification('กรุณากรอกรหัสยืนยัน 6 หลัก', 'error');
      }
    }
    
    // Auto-tab between code inputs
    codeInputs.forEach((input, index) => {
      input.addEventListener('input', () => {
        if (input.value.length === 1 && index < codeInputs.length - 1) {
          codeInputs[index + 1].focus();
        }
      });
      
      input.addEventListener('keydown', (e) => {
        if (e.key === 'Backspace' && input.value === '' && index > 0) {
          codeInputs[index - 1].focus();
        }
      });
    });
    
    // ==================== Login Functionality ====================
    async function login() {
      const username = document.getElementById('loginUsername').value.trim();
      const password = document.getElementById('loginPassword').value;
      
      // Clear errors
      hideError('loginUsername');
      hideError('loginPassword');
      
      let valid = true;
      
      // Validation
      if (!username) {
        showError('loginUsername', 'กรุณากรอกอีเมลหรือเบอร์โทรศัพท์');
        valid = false;
      }
      
      if (!password) {
        showError('loginPassword', 'กรุณากรอกรหัสผ่าน');
        valid = false;
      } else if (password.length < 6) {
        showError('loginPassword', 'รหัสผ่านต้องมีความยาวอย่างน้อย 6 ตัว');
        valid = false;
      }
      
      if (!valid) return;
      
      try {
        // Simulate API call
        await new Promise(resolve => setTimeout(resolve, 1500));
        
        // Show success
        showNotification('เข้าสู่ระบบสำเร็จ! จะนำคุณไปยังหน้าหลัก', 'success');
        
        // Simulate redirect
        setTimeout(() => {
          window.location.href = 'buyer-dashboard.html';
        }, 1500);
      } catch (e) {
        showNotification('เข้าสู่ระบบไม่สำเร็จ: อีเมล/รหัสผ่านไม่ถูกต้อง', 'error');
      }
    }
    
    // ==================== Registration Functionality ====================
    async function register() {
      const fullName = document.getElementById('fullName').value.trim();
      const phone = document.getElementById('phone').value.trim();
      const email = document.getElementById('email').value.trim();
      const password = document.getElementById('password').value;
      const confirmPassword = document.getElementById('confirmPassword').value;

      // Clear errors
      hideError('fullName');
      hideError('phone');
      hideError('email');
      hideError('password');
      hideError('confirmPassword');

      let valid = true;

      // Validation
      if (!fullName) {
        showError('fullName', 'กรุณากรอกชื่อ-นามสกุล');
        valid = false;
      }

      if (!phone) {
        showError('phone', 'กรุณากรอกเบอร์โทรศัพท์');
        valid = false;
      } else if (!/^[0-9]{10}$/.test(phone)) {
        showError('phone', 'เบอร์โทรศัพท์ต้องเป็นตัวเลข 10 หลัก');
        valid = false;
      }

      if (!email) {
        showError('email', 'กรุณากรอกอีเมล');
        valid = false;
      } else if (!/^\S+@\S+\.\S+$/.test(email)) {
        showError('email', 'รูปแบบอีเมลไม่ถูกต้อง');
        valid = false;
      }

      if (!password) {
        showError('password', 'กรุณากรอกรหัสผ่าน');
        valid = false;
      } else if (password.length < 6) {
        showError('password', 'รหัสผ่านต้องมีความยาวอย่างน้อย 6 ตัว');
        valid = false;
      } else if (!/\d/.test(password)) {
        showError('password', 'รหัสผ่านต้องมีตัวเลขอย่างน้อย 1 ตัว');
        valid = false;
      }

      if (!confirmPassword) {
        showError('confirmPassword', 'กรุณายืนยันรหัสผ่าน');
        valid = false;
      } else if (password !== confirmPassword) {
        showError('confirmPassword', 'รหัสผ่านไม่ตรงกัน');
        valid = false;
      }

      if (!valid) return;

      try {
        const res = await fetch(`${API_BASE_URL}/api/register`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            user_name: fullName,
            phone: phone,
            email: email,
            password: password
          })
        });
        const data = await res.json();
        if (res.ok && data.success) {
          console.log('Register success, show verification modal');
          showVerificationModal(email);
          localStorage.setItem('buyer_email', email);
          // Force register tab and form to stay active
          registerTab.classList.add('active');
          loginTab.classList.remove('active');
          registerForm.classList.add('active');
          loginForm.classList.remove('active');
        } else {
          console.log('Register error:', data.error);
          showNotification(data.error || 'เกิดข้อผิดพลาดในการสมัครสมาชิก', 'error');
        }
      } catch (e) {
        showNotification('เกิดข้อผิดพลาดในการเชื่อมต่อเซิร์ฟเวอร์', 'error');
      }
    }
    
    // ==================== Reset Password ====================
    function openResetPasswordModal() {
      resetPasswordModal.classList.add('show');
    }
    
    function closeResetPassword() {
      resetPasswordModal.classList.remove('show');
    }
    
    async function resetPassword() {
      const email = document.getElementById('resetEmail').value.trim();
      const newPassword = document.getElementById('resetNewPassword').value;
      const confirmPassword = document.getElementById('resetConfirmPassword').value;
      
      if (!email || !newPassword || !confirmPassword) {
        showNotification('กรุณากรอกข้อมูลให้ครบถ้วน', 'error');
        return;
      }
      
      if (newPassword !== confirmPassword) {
        showNotification('รหัสผ่านใหม่ไม่ตรงกัน', 'error');
        return;
      }
      
      if (newPassword.length < 6) {
        showNotification('รหัสผ่านต้องมีอย่างน้อย 6 ตัวอักษร', 'error');
        return;
      }
      
      try {
        // Simulate API call
        await new Promise(resolve => setTimeout(resolve, 1500));
        
        // Show success
        showNotification('รีเซ็ตรหัสผ่านสำเร็จ! คุณสามารถเข้าสู่ระบบด้วยรหัสผ่านใหม่', 'success');
        closeResetPassword();
      } catch (e) {
        showNotification('เกิดข้อผิดพลาดในการรีเซ็ตรหัสผ่าน', 'error');
      }
    }
    
    // ==================== Event Listeners ====================
    document.addEventListener('DOMContentLoaded', () => {
      setupPasswordToggles();
      
      // Button event listeners
      loginBtn.addEventListener('click', login);
      registerBtn.addEventListener('click', register);
      verifyBtn.addEventListener('click', verifyEmail);
      forgotPasswordLink.addEventListener('click', (e) => {
        e.preventDefault();
        openResetPasswordModal();
      });
      resetPasswordBtn.addEventListener('click', resetPassword);
      resendLink.addEventListener('click', () => {
        showNotification('ส่งรหัสยืนยันใหม่ไปยังอีเมลของคุณแล้ว', 'success');
      });
      closeResetPasswordModal.addEventListener('click', (e) => {
        e.preventDefault();
        closeResetPassword();
      });
      closeVerificationModal.addEventListener('click', () => {
        verificationModal.classList.remove('show');
      });
      
      // Enter key submits forms (ป้องกัน Enter ใน modal verification trigger register ซ้ำ)
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') {
          const activeElement = document.activeElement;
          // Prevent register() if modal is open
          if (loginForm.classList.contains('active')) {
            login();
          } else if (registerForm.classList.contains('active') && !verificationModal.classList.contains('show')) {
            register();
          } else if (verificationModal.classList.contains('show')) {
            if (activeElement && activeElement.classList.contains('code-input')) {
              e.preventDefault();
              verifyEmail();
            } else {
              // Prevent Enter from doing anything else
              e.preventDefault();
            }
          } else if (resetPasswordModal.classList.contains('show')) {
            resetPassword();
          }
        }
      });
    });
  </script>
</body>
</html>